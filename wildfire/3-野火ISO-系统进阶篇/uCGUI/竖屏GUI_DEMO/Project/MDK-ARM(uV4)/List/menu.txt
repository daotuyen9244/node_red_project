; generated by ARM C/C++ Compiler, 5.03 [Build 76]
; commandline ArmCC [--list --split_sections --debug -c --asm --interleave -o.\obj\menu.o --asm_dir=.\List\ --list_dir=.\List\ --depend=.\obj\menu.d --cpu=Cortex-M3 --apcs=interwork -O0 -I..\..\Libraries\CMSIS\CM3\CoreSupport -I..\..\Libraries\CMSIS\CM3\DeviceSupport\ST\STM32F10x -I..\..\Libraries\STM32F10x_StdPeriph_Driver\inc -I..\..\uCOS-II\Source -I..\..\uCOS-II\Ports\ARM-Cortex-M3\Generic\RealView -I..\..\User\app -I..\..\User\bsp -I..\..\uCGUI\inc -I..\..\uCGUI\Config -I..\..\uCGUI\LCDDriver -I..\..\uCGUI\uCGUIDemo -I..\..\User\fatfs -I..\..\User\mp3\pub -I..\..\User\Memory -Id:\Keil\ARM\RV31\INC -Id:\Keil\ARM\CMSIS\Include -Id:\Keil\ARM\Inc\ST\STM32F10x -D__MICROLIB -DSTM32F10X_HD -DUSE_STDPERIPH_DRIVER ..\..\uCGUI\Widget\MENU.c]
                          THUMB

                          AREA ||i.MENU_AddItem||, CODE, READONLY, ALIGN=1

                  MENU_AddItem PROC
;;;1366   */
;;;1367   void MENU_AddItem(MENU_Handle hObj, const MENU_ITEM_DATA* pItemData) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  4606              MOV      r6,r0
000006  460d              MOV      r5,r1
;;;1368     if (hObj && pItemData) {
000008  b33e              CBZ      r6,|L1.90|
00000a  b335              CBZ      r5,|L1.90|
;;;1369       MENU_Obj* pObj;
;;;1370       WM_LOCK();
00000c  f7fffffe          BL       GUI_Lock
;;;1371       pObj = MENU_H2P(hObj);
000010  4630              MOV      r0,r6
000012  f7fffffe          BL       GUI_ALLOC_h2p
000016  4604              MOV      r4,r0
;;;1372       if (pObj) {
000018  b1e4              CBZ      r4,|L1.84|
;;;1373         if (GUI_ARRAY_AddItem(&pObj->ItemArray, NULL, 0) == 0) {
00001a  2200              MOVS     r2,#0
00001c  4611              MOV      r1,r2
00001e  f1040058          ADD      r0,r4,#0x58
000022  f7fffffe          BL       GUI_ARRAY_AddItem
000026  b9a8              CBNZ     r0,|L1.84|
;;;1374           unsigned Index;
;;;1375           Index = MENU__GetNumItems(pObj) - 1;
000028  4620              MOV      r0,r4
00002a  f7fffffe          BL       MENU__GetNumItems
00002e  1e47              SUBS     r7,r0,#1
;;;1376           if (MENU__SetItem(hObj, pObj, Index, pItemData) == 0) {
000030  462b              MOV      r3,r5
000032  463a              MOV      r2,r7
000034  4621              MOV      r1,r4
000036  4630              MOV      r0,r6
000038  f7fffffe          BL       MENU__SetItem
00003c  b928              CBNZ     r0,|L1.74|
;;;1377             GUI_ARRAY_DeleteItem(&pObj->ItemArray, Index);
00003e  4639              MOV      r1,r7
000040  f1040058          ADD      r0,r4,#0x58
000044  f7fffffe          BL       GUI_ARRAY_DeleteItem
000048  e003              B        |L1.82|
                  |L1.74|
;;;1378           } else {
;;;1379             MENU__ResizeMenu(hObj, pObj);
00004a  4621              MOV      r1,r4
00004c  4630              MOV      r0,r6
00004e  f7fffffe          BL       MENU__ResizeMenu
                  |L1.82|
;;;1380           }
;;;1381         }
000052  bf00              NOP      
                  |L1.84|
;;;1382       }
;;;1383       WM_UNLOCK();
000054  f7fffffe          BL       GUI_Unlock
;;;1384     }
000058  bf00              NOP      
                  |L1.90|
;;;1385   }
00005a  e8bd81f0          POP      {r4-r8,pc}
;;;1386   
                          ENDP


                          AREA ||i.MENU_Callback||, CODE, READONLY, ALIGN=1

                  MENU_Callback PROC
;;;1134   */
;;;1135   void MENU_Callback(WM_MESSAGE* pMsg) {
000000  e92d47f0          PUSH     {r4-r10,lr}
000004  4604              MOV      r4,r0
;;;1136     MENU_Handle hObj;
;;;1137     MENU_Obj* pObj;
;;;1138     int OldWidgetState, Result, HasFocus;
;;;1139     hObj = pMsg->hWin;
000006  f9b47004          LDRSH    r7,[r4,#4]
;;;1140     pObj = (MENU_Obj*) GUI_ALLOC_h2p(hObj); /* Don't use use WIDGET_H2P because WIDGET_INIT_ID() has not be called at this point */
00000a  4638              MOV      r0,r7
00000c  f7fffffe          BL       GUI_ALLOC_h2p
000010  4605              MOV      r5,r0
;;;1141     OldWidgetState = pObj->Widget.State;
000012  f8b58026          LDRH     r8,[r5,#0x26]
;;;1142     Result = 1;
000016  f04f0901          MOV      r9,#1
;;;1143     if (pMsg->MsgId != WM_PID_STATE_CHANGED) {
00001a  6820              LDR      r0,[r4,#0]
00001c  2811              CMP      r0,#0x11
00001e  d004              BEQ      |L2.42|
;;;1144       /* Let widget handle the standard messages */
;;;1145       Result = WIDGET_HandleActive(hObj, pMsg);
000020  4621              MOV      r1,r4
000022  4638              MOV      r0,r7
000024  f7fffffe          BL       WIDGET_HandleActive
000028  4681              MOV      r9,r0
                  |L2.42|
;;;1146     }
;;;1147     HasFocus = pObj->Widget.State & WIDGET_STATE_FOCUS;
00002a  f8950026          LDRB     r0,[r5,#0x26]
00002e  f0000601          AND      r6,r0,#1
;;;1148     /* React on focus change */
;;;1149     if ((OldWidgetState & WIDGET_STATE_FOCUS) != HasFocus) {
000032  f0080001          AND      r0,r8,#1
000036  42b0              CMP      r0,r6
000038  d021              BEQ      |L2.126|
;;;1150       if (HasFocus) {
00003a  b1b6              CBZ      r6,|L2.106|
;;;1151         _CloseSubmenu(hObj, pObj);
00003c  4629              MOV      r1,r5
00003e  4638              MOV      r0,r7
000040  f7fffffe          BL       _CloseSubmenu
;;;1152         pObj->Flags &= ~MENU_SF_ACTIVE;
000044  f8b5005e          LDRH     r0,[r5,#0x5e]
000048  f0200040          BIC      r0,r0,#0x40
00004c  f8a5005e          STRH     r0,[r5,#0x5e]
;;;1153         if (pObj->Sel <= 0) {
000050  6ee8              LDR      r0,[r5,#0x6c]
000052  2800              CMP      r0,#0
000054  dc13              BGT      |L2.126|
;;;1154           _SetSelection(hObj, pObj, 0);
000056  2200              MOVS     r2,#0
000058  4629              MOV      r1,r5
00005a  4638              MOV      r0,r7
00005c  f7fffffe          BL       _SetSelection
;;;1155           _SetCapture(hObj, pObj);
000060  4629              MOV      r1,r5
000062  4638              MOV      r0,r7
000064  f7fffffe          BL       _SetCapture
000068  e009              B        |L2.126|
                  |L2.106|
;;;1156         }
;;;1157       } else {
;;;1158         _SetSelection(hObj, pObj, -1);
00006a  f04f32ff          MOV      r2,#0xffffffff
00006e  4629              MOV      r1,r5
000070  4638              MOV      r0,r7
000072  f7fffffe          BL       _SetSelection
;;;1159         _ReleaseCapture(hObj, pObj);
000076  4629              MOV      r1,r5
000078  4638              MOV      r0,r7
00007a  f7fffffe          BL       _ReleaseCapture
                  |L2.126|
;;;1160       }
;;;1161     }
;;;1162     /* Return if message already has been processed */
;;;1163     if (!Result) {
00007e  f1b90f00          CMP      r9,#0
000082  d101              BNE      |L2.136|
                  |L2.132|
;;;1164       return;
;;;1165     }
;;;1166     switch (pMsg->MsgId) {
;;;1167     case WM_MENU:
;;;1168       _OnMenu(hObj, pObj, pMsg);
;;;1169       return;     /* Message handled, do not call WM_DefaultProc() here. */
;;;1170     case WM_TOUCH:
;;;1171       if (_OnTouch(hObj, pObj, pMsg)) {
;;;1172         _ForwardPIDMsgToOwner(hObj, pObj, pMsg);
;;;1173       }
;;;1174       break;
;;;1175   #if (GUI_SUPPORT_MOUSE)
;;;1176     case WM_MOUSEOVER:
;;;1177       if (_OnMouseOver(hObj, pObj, pMsg)) {
;;;1178         _ForwardPIDMsgToOwner(hObj, pObj, pMsg);
;;;1179       }
;;;1180       break;
;;;1181   #endif
;;;1182     case WM_KEY:
;;;1183       if (((const WM_KEY_INFO*)(pMsg->Data.p))->PressedCnt > 0) {
;;;1184         if (!_OnKey(hObj, pObj, ((const WM_KEY_INFO*)(pMsg->Data.p))->Key)) {
;;;1185           return;
;;;1186         }
;;;1187       }
;;;1188       break;
;;;1189     case WM_PAINT:
;;;1190       _OnPaint(hObj, pObj);
;;;1191       break;
;;;1192     case WM_DELETE:
;;;1193       GUI_ARRAY_Delete(&pObj->ItemArray);
;;;1194       break;      /* No return here ... WM_DefaultProc needs to be called */
;;;1195     }
;;;1196     WM_DefaultProc(pMsg);
;;;1197   }
000084  e8bd87f0          POP      {r4-r10,pc}
                  |L2.136|
000088  6820              LDR      r0,[r4,#0]            ;1166
00008a  280e              CMP      r0,#0xe               ;1166
00008c  d01b              BEQ      |L2.198|
00008e  dc04              BGT      |L2.154|
000090  280b              CMP      r0,#0xb               ;1166
000092  d02a              BEQ      |L2.234|
000094  280c              CMP      r0,#0xc               ;1166
000096  d12d              BNE      |L2.244|
000098  e009              B        |L2.174|
                  |L2.154|
00009a  280f              CMP      r0,#0xf               ;1166
00009c  d020              BEQ      |L2.224|
00009e  282c              CMP      r0,#0x2c              ;1166
0000a0  d128              BNE      |L2.244|
0000a2  4622              MOV      r2,r4                 ;1168
0000a4  4629              MOV      r1,r5                 ;1168
0000a6  4638              MOV      r0,r7                 ;1168
0000a8  f7fffffe          BL       _OnMenu
0000ac  e7ea              B        |L2.132|
                  |L2.174|
0000ae  4622              MOV      r2,r4                 ;1171
0000b0  4629              MOV      r1,r5                 ;1171
0000b2  4638              MOV      r0,r7                 ;1171
0000b4  f7fffffe          BL       _OnTouch
0000b8  b120              CBZ      r0,|L2.196|
0000ba  4622              MOV      r2,r4                 ;1172
0000bc  4629              MOV      r1,r5                 ;1172
0000be  4638              MOV      r0,r7                 ;1172
0000c0  f7fffffe          BL       _ForwardPIDMsgToOwner
                  |L2.196|
0000c4  e016              B        |L2.244|
                  |L2.198|
0000c6  68a0              LDR      r0,[r4,#8]            ;1183
0000c8  6840              LDR      r0,[r0,#4]            ;1183
0000ca  2800              CMP      r0,#0                 ;1183
0000cc  dd07              BLE      |L2.222|
0000ce  68a0              LDR      r0,[r4,#8]            ;1184
0000d0  4629              MOV      r1,r5                 ;1184
0000d2  6802              LDR      r2,[r0,#0]            ;1184
0000d4  4638              MOV      r0,r7                 ;1184
0000d6  f7fffffe          BL       _OnKey
0000da  b900              CBNZ     r0,|L2.222|
0000dc  e7d2              B        |L2.132|
                  |L2.222|
0000de  e009              B        |L2.244|
                  |L2.224|
0000e0  4629              MOV      r1,r5                 ;1190
0000e2  4638              MOV      r0,r7                 ;1190
0000e4  f7fffffe          BL       _OnPaint
0000e8  e004              B        |L2.244|
                  |L2.234|
0000ea  f1050058          ADD      r0,r5,#0x58           ;1193
0000ee  f7fffffe          BL       GUI_ARRAY_Delete
0000f2  bf00              NOP                            ;1194
                  |L2.244|
0000f4  bf00              NOP                            ;1174
0000f6  4620              MOV      r0,r4                 ;1196
0000f8  f7fffffe          BL       WM_DefaultProc
0000fc  bf00              NOP      
0000fe  e7c1              B        |L2.132|
;;;1198   
                          ENDP


                          AREA ||i.MENU_CreateEx||, CODE, READONLY, ALIGN=2

                  MENU_CreateEx PROC
;;;1208   */
;;;1209   MENU_Handle MENU_CreateEx(int x0, int y0, int xSize, int ySize, WM_HWIN hParent, int WinFlags, int ExFlags, int Id) {
000000  e92d5fff          PUSH     {r0-r12,lr}
000004  4681              MOV      r9,r0
000006  468a              MOV      r10,r1
000008  4616              MOV      r6,r2
00000a  461f              MOV      r7,r3
00000c  f8ddb038          LDR      r11,[sp,#0x38]
000010  9d10              LDR      r5,[sp,#0x40]
;;;1210     MENU_Handle hObj;
;;;1211     /* Create the window */
;;;1212     WM_LOCK();
000012  f7fffffe          BL       GUI_Lock
;;;1213     hObj = WM_CreateWindowAsChild(x0, y0, xSize, ySize, hParent, WM_CF_SHOW | WM_CF_STAYONTOP | WinFlags, &MENU_Callback,
000016  2150              MOVS     r1,#0x50
000018  4a25              LDR      r2,|L3.176|
00001a  980f              LDR      r0,[sp,#0x3c]
00001c  b280              UXTH     r0,r0
00001e  f040000a          ORR      r0,r0,#0xa
000022  463b              MOV      r3,r7
000024  e9cdb000          STRD     r11,r0,[sp,#0]
000028  e9cd2102          STRD     r2,r1,[sp,#8]
00002c  4632              MOV      r2,r6
00002e  4651              MOV      r1,r10
000030  4648              MOV      r0,r9
000032  f7fffffe          BL       WM_CreateWindowAsChild
000036  4680              MOV      r8,r0
;;;1214                                   sizeof(MENU_Obj) - sizeof(WM_Obj));
;;;1215     if (hObj) {
000038  f1b80f00          CMP      r8,#0
00003c  d032              BEQ      |L3.164|
;;;1216       MENU_Obj* pObj;
;;;1217       pObj = (MENU_Obj*)GUI_ALLOC_h2p(hObj); /* Don't use use WIDGET_H2P because WIDGET_INIT_ID() has not be called at this point */
00003e  4640              MOV      r0,r8
000040  f7fffffe          BL       GUI_ALLOC_h2p
000044  4604              MOV      r4,r0
;;;1218        /* Init sub-classes */
;;;1219       GUI_ARRAY_CREATE(&pObj->ItemArray);
;;;1220       /* init widget specific variables */
;;;1221       WIDGET__Init(&pObj->Widget, Id, WIDGET_STATE_FOCUSSABLE);
000046  2210              MOVS     r2,#0x10
000048  4620              MOV      r0,r4
00004a  9911              LDR      r1,[sp,#0x44]
00004c  f7fffffe          BL       WIDGET__Init
;;;1222       /* init member variables */
;;;1223       MENU_INIT_ID(pObj);
;;;1224       if (ExFlags & MENU_SF_OPEN_ON_POINTEROVER) {
000050  f0150f02          TST      r5,#2
000054  d002              BEQ      |L3.92|
;;;1225         ExFlags |= MENU_SF_ACTIVE;
000056  f0450540          ORR      r5,r5,#0x40
00005a  e001              B        |L3.96|
                  |L3.92|
;;;1226       } else {
;;;1227         ExFlags &= ~(MENU_SF_ACTIVE);
00005c  f0250540          BIC      r5,r5,#0x40
                  |L3.96|
;;;1228       }
;;;1229       pObj->Props           = MENU__DefaultProps;
000060  2230              MOVS     r2,#0x30
000062  4914              LDR      r1,|L3.180|
000064  f1040028          ADD      r0,r4,#0x28
000068  f7fffffe          BL       __aeabi_memcpy4
;;;1230       pObj->Flags           = ExFlags;
00006c  f8a4505e          STRH     r5,[r4,#0x5e]
;;;1231       pObj->Width           = ((xSize > 0) ? xSize : 0);
000070  2e00              CMP      r6,#0
000072  dd01              BLE      |L3.120|
000074  4630              MOV      r0,r6
000076  e000              B        |L3.122|
                  |L3.120|
000078  2000              MOVS     r0,#0
                  |L3.122|
00007a  6660              STR      r0,[r4,#0x64]
;;;1232       pObj->Height          = ((ySize > 0) ? ySize : 0);
00007c  2f00              CMP      r7,#0
00007e  dd01              BLE      |L3.132|
000080  4638              MOV      r0,r7
000082  e000              B        |L3.134|
                  |L3.132|
000084  2000              MOVS     r0,#0
                  |L3.134|
000086  66a0              STR      r0,[r4,#0x68]
;;;1233       pObj->Sel             = -1;
000088  f04f30ff          MOV      r0,#0xffffffff
00008c  66e0              STR      r0,[r4,#0x6c]
;;;1234       pObj->hOwner          = 0;
00008e  2000              MOVS     r0,#0
000090  f8a4005c          STRH     r0,[r4,#0x5c]
;;;1235       pObj->IsSubmenuActive = 0;
000094  f8840060          STRB     r0,[r4,#0x60]
;;;1236       WIDGET_SetEffect(hObj, MENU__pDefaultEffect);
000098  4807              LDR      r0,|L3.184|
00009a  6801              LDR      r1,[r0,#0]  ; MENU__pDefaultEffect
00009c  4640              MOV      r0,r8
00009e  f7fffffe          BL       WIDGET_SetEffect
;;;1237     } else {
0000a2  bf00              NOP      
                  |L3.164|
;;;1238       GUI_DEBUG_ERROROUT_IF(hObj==0, "MENU_CreateEx failed")
;;;1239     }
;;;1240     WM_UNLOCK();
0000a4  f7fffffe          BL       GUI_Unlock
;;;1241     return hObj;
0000a8  4640              MOV      r0,r8
;;;1242   }
0000aa  b004              ADD      sp,sp,#0x10
0000ac  e8bd9ff0          POP      {r4-r12,pc}
;;;1243   
                          ENDP

                  |L3.176|
                          DCD      MENU_Callback
                  |L3.180|
                          DCD      MENU__DefaultProps
                  |L3.184|
                          DCD      MENU__pDefaultEffect

                          AREA ||i.MENU_SetOwner||, CODE, READONLY, ALIGN=1

                  MENU_SetOwner PROC
;;;1390   */
;;;1391   void MENU_SetOwner(MENU_Handle hObj, WM_HWIN hOwner) {
000000  b570              PUSH     {r4-r6,lr}
000002  4604              MOV      r4,r0
000004  460d              MOV      r5,r1
;;;1392     if (hObj) {
000006  b15c              CBZ      r4,|L4.32|
;;;1393       MENU_Obj* pObj;
;;;1394       WM_LOCK();
000008  f7fffffe          BL       GUI_Lock
;;;1395       pObj = MENU_H2P(hObj);
00000c  4620              MOV      r0,r4
00000e  f7fffffe          BL       GUI_ALLOC_h2p
000012  4606              MOV      r6,r0
;;;1396       if (pObj) {
000014  b10e              CBZ      r6,|L4.26|
;;;1397         pObj->hOwner = hOwner;
000016  f8a6505c          STRH     r5,[r6,#0x5c]
                  |L4.26|
;;;1398       }
;;;1399       WM_UNLOCK();
00001a  f7fffffe          BL       GUI_Unlock
;;;1400     }
00001e  bf00              NOP      
                  |L4.32|
;;;1401   }
000020  bd70              POP      {r4-r6,pc}
;;;1402   
                          ENDP


                          AREA ||i.MENU__GetNumItems||, CODE, READONLY, ALIGN=1

                  MENU__GetNumItems PROC
;;;1253   */
;;;1254   unsigned MENU__GetNumItems(MENU_Obj* pObj) {
000000  b510              PUSH     {r4,lr}
000002  4604              MOV      r4,r0
;;;1255     return GUI_ARRAY_GetNumItems(&pObj->ItemArray);
000004  f1040058          ADD      r0,r4,#0x58
000008  f7fffffe          BL       GUI_ARRAY_GetNumItems
;;;1256   }
00000c  bd10              POP      {r4,pc}
;;;1257   
                          ENDP


                          AREA ||i.MENU__InvalidateItem||, CODE, READONLY, ALIGN=1

                  MENU__InvalidateItem PROC
;;;1261   */
;;;1262   void MENU__InvalidateItem(MENU_Handle hObj, const MENU_Obj* pObj, unsigned Index) {
000000  b570              PUSH     {r4-r6,lr}
000002  4606              MOV      r6,r0
000004  460c              MOV      r4,r1
000006  4615              MOV      r5,r2
;;;1263     GUI_USE_PARA(pObj);
000008  bf00              NOP      
;;;1264     GUI_USE_PARA(Index);
00000a  bf00              NOP      
;;;1265     WM_InvalidateWindow(hObj);  /* Can be optimized, no need to invalidate all items */
00000c  4630              MOV      r0,r6
00000e  f7fffffe          BL       WM_InvalidateWindow
;;;1266   }
000012  bd70              POP      {r4-r6,pc}
;;;1267   
                          ENDP


                          AREA ||i.MENU__RecalcTextWidthOfItems||, CODE, READONLY, ALIGN=1

                  MENU__RecalcTextWidthOfItems PROC
;;;1271   */
;;;1272   void MENU__RecalcTextWidthOfItems(MENU_Obj* pObj) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  4604              MOV      r4,r0
;;;1273     const GUI_FONT GUI_UNI_PTR* pOldFont;
;;;1274     MENU_ITEM* pItem;
;;;1275     unsigned i, NumItems;
;;;1276     NumItems = MENU__GetNumItems(pObj);
000006  4620              MOV      r0,r4
000008  f7fffffe          BL       MENU__GetNumItems
00000c  4680              MOV      r8,r0
;;;1277     pOldFont  = GUI_SetFont(pObj->Props.pFont);
00000e  6d60              LDR      r0,[r4,#0x54]
000010  f7fffffe          BL       GUI_SetFont
000014  4607              MOV      r7,r0
;;;1278     for (i = 0; i < NumItems; i++) {
000016  2600              MOVS     r6,#0
000018  e00b              B        |L7.50|
                  |L7.26|
;;;1279       pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, i);
00001a  4631              MOV      r1,r6
00001c  f1040058          ADD      r0,r4,#0x58
000020  f7fffffe          BL       GUI_ARRAY_GetpItem
000024  4605              MOV      r5,r0
;;;1280       pItem->TextWidth = GUI_GetStringDistX(pItem->acText);
000026  f105000c          ADD      r0,r5,#0xc
00002a  f7fffffe          BL       GUI_GetStringDistX
00002e  60a8              STR      r0,[r5,#8]
000030  1c76              ADDS     r6,r6,#1              ;1278
                  |L7.50|
000032  4546              CMP      r6,r8                 ;1278
000034  d3f1              BCC      |L7.26|
;;;1281     }
;;;1282     GUI_SetFont(pOldFont);
000036  4638              MOV      r0,r7
000038  f7fffffe          BL       GUI_SetFont
;;;1283   }
00003c  e8bd81f0          POP      {r4-r8,pc}
;;;1284   
                          ENDP


                          AREA ||i.MENU__ResizeMenu||, CODE, READONLY, ALIGN=1

                  MENU__ResizeMenu PROC
;;;1288   */
;;;1289   void MENU__ResizeMenu(MENU_Handle hObj, MENU_Obj* pObj) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  4604              MOV      r4,r0
000006  460d              MOV      r5,r1
;;;1290     int xSize, ySize;
;;;1291     xSize = _CalcWindowSizeX(hObj, pObj);
000008  4629              MOV      r1,r5
00000a  4620              MOV      r0,r4
00000c  f7fffffe          BL       _CalcWindowSizeX
000010  4606              MOV      r6,r0
;;;1292     ySize = _CalcWindowSizeY(hObj, pObj);
000012  4629              MOV      r1,r5
000014  4620              MOV      r0,r4
000016  f7fffffe          BL       _CalcWindowSizeY
00001a  4607              MOV      r7,r0
;;;1293     WM_SetSize(hObj, xSize, ySize);
00001c  463a              MOV      r2,r7
00001e  4631              MOV      r1,r6
000020  4620              MOV      r0,r4
000022  f7fffffe          BL       WM_SetSize
;;;1294     WM_InvalidateWindow(hObj);
000026  4620              MOV      r0,r4
000028  f7fffffe          BL       WM_InvalidateWindow
;;;1295   }
00002c  e8bd81f0          POP      {r4-r8,pc}
;;;1296   
                          ENDP


                          AREA ||i.MENU__SendMenuMessage||, CODE, READONLY, ALIGN=1

                  MENU__SendMenuMessage PROC
;;;1338   */
;;;1339   int MENU__SendMenuMessage(MENU_Handle hObj, WM_HWIN hDestWin, U16 MsgType, U16 ItemId) {
000000  e92d41ff          PUSH     {r0-r8,lr}
000004  4605              MOV      r5,r0
000006  460c              MOV      r4,r1
000008  4616              MOV      r6,r2
00000a  461f              MOV      r7,r3
;;;1340     MENU_MSG_DATA MsgData;
;;;1341     WM_MESSAGE    Msg = {0};
00000c  2000              MOVS     r0,#0
00000e  9000              STR      r0,[sp,#0]
000010  9001              STR      r0,[sp,#4]
000012  9002              STR      r0,[sp,#8]
;;;1342     MsgData.MsgType   = MsgType;
000014  f8ad600c          STRH     r6,[sp,#0xc]
;;;1343     MsgData.ItemId    = ItemId;
000018  f8ad700e          STRH     r7,[sp,#0xe]
;;;1344     Msg.MsgId         = WM_MENU;
00001c  202c              MOVS     r0,#0x2c
00001e  9000              STR      r0,[sp,#0]
;;;1345     Msg.Data.p        = &MsgData;
000020  a803              ADD      r0,sp,#0xc
000022  9002              STR      r0,[sp,#8]
;;;1346     Msg.hWinSrc       = hObj;
000024  f8ad5006          STRH     r5,[sp,#6]
;;;1347     if (!hDestWin) {
000028  b91c              CBNZ     r4,|L9.50|
;;;1348       hDestWin = WM_GetParent(hObj);
00002a  4628              MOV      r0,r5
00002c  f7fffffe          BL       WM_GetParent
000030  4604              MOV      r4,r0
                  |L9.50|
;;;1349     }
;;;1350     if (hDestWin) {
000032  b13c              CBZ      r4,|L9.68|
;;;1351       WM__SendMessage(hDestWin, &Msg);
000034  4669              MOV      r1,sp
000036  4620              MOV      r0,r4
000038  f7fffffe          BL       WM__SendMessage
;;;1352       return Msg.Data.v;
00003c  9802              LDR      r0,[sp,#8]
                  |L9.62|
;;;1353     }
;;;1354     return 0;
;;;1355   }
00003e  b004              ADD      sp,sp,#0x10
000040  e8bd81f0          POP      {r4-r8,pc}
                  |L9.68|
000044  2000              MOVS     r0,#0                 ;1354
000046  e7fa              B        |L9.62|
;;;1356   
                          ENDP


                          AREA ||i.MENU__SetItem||, CODE, READONLY, ALIGN=2

                  MENU__SetItem PROC
;;;1300   */
;;;1301   char MENU__SetItem(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index, const MENU_ITEM_DATA* pItemData) {
000000  e92d47ff          PUSH     {r0-r10,lr}
000004  4607              MOV      r7,r0
000006  460d              MOV      r5,r1
000008  4690              MOV      r8,r2
00000a  461c              MOV      r4,r3
;;;1302     MENU_ITEM Item = {0};
00000c  2000              MOVS     r0,#0
00000e  9000              STR      r0,[sp,#0]
000010  9001              STR      r0,[sp,#4]
000012  9002              STR      r0,[sp,#8]
000014  9003              STR      r0,[sp,#0xc]
;;;1303     const char* pText;
;;;1304     pText = pItemData->pText;
000016  6826              LDR      r6,[r4,#0]
;;;1305     if (!pText) {
000018  b906              CBNZ     r6,|L10.28|
;;;1306       pText = "";
00001a  a61f              ADR      r6,|L10.152|
                  |L10.28|
;;;1307     }
;;;1308     Item.Id        = pItemData->Id;
00001c  88a0              LDRH     r0,[r4,#4]
00001e  f8ad0002          STRH     r0,[sp,#2]
;;;1309     Item.Flags     = pItemData->Flags;
000022  88e0              LDRH     r0,[r4,#6]
000024  f8ad0004          STRH     r0,[sp,#4]
;;;1310     Item.hSubmenu  = pItemData->hSubmenu;
000028  8920              LDRH     r0,[r4,#8]
00002a  f8ad0000          STRH     r0,[sp,#0]
;;;1311     Item.TextWidth = _CalcTextWidth(pObj, pText);
00002e  4631              MOV      r1,r6
000030  4628              MOV      r0,r5
000032  f7fffffe          BL       _CalcTextWidth
000036  9002              STR      r0,[sp,#8]
;;;1312     if (Item.Flags & MENU_IF_SEPARATOR) {
000038  f8bd0004          LDRH     r0,[sp,#4]
00003c  f0100f02          TST      r0,#2
000040  d002              BEQ      |L10.72|
;;;1313       Item.hSubmenu = 0;   /* Ensures that no separator is a submenu */
000042  2000              MOVS     r0,#0
000044  f8ad0000          STRH     r0,[sp,#0]
                  |L10.72|
;;;1314     }
;;;1315     if (GUI_ARRAY_SetItem(&pObj->ItemArray, Index, &Item, sizeof(MENU_ITEM) + strlen(pText)) != 0) {
000048  4630              MOV      r0,r6
00004a  f7fffffe          BL       strlen
00004e  f1000910          ADD      r9,r0,#0x10
000052  464b              MOV      r3,r9
000054  466a              MOV      r2,sp
000056  4641              MOV      r1,r8
000058  f1050058          ADD      r0,r5,#0x58
00005c  f7fffffe          BL       GUI_ARRAY_SetItem
000060  b1b8              CBZ      r0,|L10.146|
;;;1316       MENU_ITEM* pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
000062  4641              MOV      r1,r8
000064  f1050058          ADD      r0,r5,#0x58
000068  f7fffffe          BL       GUI_ARRAY_GetpItem
00006c  4681              MOV      r9,r0
;;;1317       strcpy(pItem->acText, pText);
00006e  4631              MOV      r1,r6
000070  f109000c          ADD      r0,r9,#0xc
000074  f7fffffe          BL       strcpy
;;;1318       MENU_SetOwner(Item.hSubmenu, hObj);
000078  f9bd0000          LDRSH    r0,[sp,#0]
00007c  4639              MOV      r1,r7
00007e  f7fffffe          BL       MENU_SetOwner
;;;1319       WM_DetachWindow(Item.hSubmenu);   /* Ensures all submenus are initially closed */
000082  f9bd0000          LDRSH    r0,[sp,#0]
000086  f7fffffe          BL       WM_DetachWindow
;;;1320       return 1;
00008a  2001              MOVS     r0,#1
                  |L10.140|
;;;1321     }
;;;1322     return 0;
;;;1323   }
00008c  b004              ADD      sp,sp,#0x10
00008e  e8bd87f0          POP      {r4-r10,pc}
                  |L10.146|
000092  2000              MOVS     r0,#0                 ;1322
000094  e7fa              B        |L10.140|
;;;1324   
                          ENDP

000096  0000              DCW      0x0000
                  |L10.152|
000098  00                DCB      0
000099  00                DCB      0
00009a  00                DCB      0
00009b  00                DCB      0

                          AREA ||i.MENU__SetItemFlags||, CODE, READONLY, ALIGN=1

                  MENU__SetItemFlags PROC
;;;1328   */
;;;1329   void MENU__SetItemFlags(MENU_Obj* pObj, unsigned Index, U16 Mask, U16 Flags) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  4605              MOV      r5,r0
000006  4688              MOV      r8,r1
000008  4616              MOV      r6,r2
00000a  461f              MOV      r7,r3
;;;1330     MENU_ITEM* pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
00000c  4641              MOV      r1,r8
00000e  f1050058          ADD      r0,r5,#0x58
000012  f7fffffe          BL       GUI_ARRAY_GetpItem
000016  4604              MOV      r4,r0
;;;1331     pItem->Flags &= ~Mask;
000018  88a0              LDRH     r0,[r4,#4]
00001a  43b0              BICS     r0,r0,r6
00001c  80a0              STRH     r0,[r4,#4]
;;;1332     pItem->Flags |= Flags;
00001e  88a0              LDRH     r0,[r4,#4]
000020  4338              ORRS     r0,r0,r7
000022  80a0              STRH     r0,[r4,#4]
;;;1333   }
000024  e8bd81f0          POP      {r4-r8,pc}
;;;1334   
                          ENDP


                          AREA ||i._ActivateItem||, CODE, READONLY, ALIGN=1

                  _ActivateItem PROC
;;;575    */
;;;576    static void _ActivateItem(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  4607              MOV      r7,r0
000006  460c              MOV      r4,r1
000008  4616              MOV      r6,r2
;;;577      MENU_ITEM* pItem;
;;;578      pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
00000a  4631              MOV      r1,r6
00000c  f1040058          ADD      r0,r4,#0x58
000010  f7fffffe          BL       GUI_ARRAY_GetpItem
000014  4605              MOV      r5,r0
;;;579      if (pItem->hSubmenu == 0) {
000016  8828              LDRH     r0,[r5,#0]
000018  b970              CBNZ     r0,|L12.56|
;;;580        if ((pItem->Flags & (MENU_IF_DISABLED | MENU_IF_SEPARATOR)) == 0) {
00001a  7928              LDRB     r0,[r5,#4]
00001c  f0100f03          TST      r0,#3
000020  d10a              BNE      |L12.56|
;;;581          _ClosePopup(hObj, pObj);
000022  4621              MOV      r1,r4
000024  4638              MOV      r0,r7
000026  f7fffffe          BL       _ClosePopup
;;;582          /* Send item select message to owner. */
;;;583          MENU__SendMenuMessage(hObj, pObj->hOwner, MENU_ON_ITEMSELECT, pItem->Id);
00002a  886b              LDRH     r3,[r5,#2]
00002c  f9b4105c          LDRSH    r1,[r4,#0x5c]
000030  2200              MOVS     r2,#0
000032  4638              MOV      r0,r7
000034  f7fffffe          BL       MENU__SendMenuMessage
                  |L12.56|
;;;584        }
;;;585      }
;;;586    }
000038  e8bd81f0          POP      {r4-r8,pc}
;;;587    
                          ENDP


                          AREA ||i._ActivateMenu||, CODE, READONLY, ALIGN=1

                  _ActivateMenu PROC
;;;591    */
;;;592    static void _ActivateMenu(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  4607              MOV      r7,r0
000006  460c              MOV      r4,r1
000008  4615              MOV      r5,r2
;;;593      if ((pObj->Flags & MENU_SF_OPEN_ON_POINTEROVER) == 0) {
00000a  f894005e          LDRB     r0,[r4,#0x5e]
00000e  f0100f02          TST      r0,#2
000012  d134              BNE      |L13.126|
;;;594        MENU_ITEM* pItem;
;;;595        pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
000014  4629              MOV      r1,r5
000016  f1040058          ADD      r0,r4,#0x58
00001a  f7fffffe          BL       GUI_ARRAY_GetpItem
00001e  4606              MOV      r6,r0
;;;596        if (pItem->hSubmenu) {
000020  8830              LDRH     r0,[r6,#0]
000022  b358              CBZ      r0,|L13.124|
;;;597          if ((pItem->Flags & MENU_IF_DISABLED) == 0) {
000024  7930              LDRB     r0,[r6,#4]
000026  f0100f01          TST      r0,#1
00002a  d127              BNE      |L13.124|
;;;598            if ((pObj->Flags & MENU_SF_ACTIVE) == 0) {
00002c  f894005e          LDRB     r0,[r4,#0x5e]
000030  f0100f40          TST      r0,#0x40
000034  d110              BNE      |L13.88|
;;;599              pObj->Flags |= MENU_SF_ACTIVE;
000036  f8b4005e          LDRH     r0,[r4,#0x5e]
00003a  f0400040          ORR      r0,r0,#0x40
00003e  f8a4005e          STRH     r0,[r4,#0x5e]
;;;600              _OpenSubmenu(hObj, pObj, Index);
000042  462a              MOV      r2,r5
000044  4621              MOV      r1,r4
000046  4638              MOV      r0,r7
000048  f7fffffe          BL       _OpenSubmenu
;;;601              _SetSelection(hObj, pObj, Index);
00004c  462a              MOV      r2,r5
00004e  4621              MOV      r1,r4
000050  4638              MOV      r0,r7
000052  f7fffffe          BL       _SetSelection
000056  e011              B        |L13.124|
                  |L13.88|
;;;602            } else if (pObj->Flags & MENU_SF_CLOSE_ON_SECOND_CLICK) {
000058  f894005e          LDRB     r0,[r4,#0x5e]
00005c  f0100f04          TST      r0,#4
000060  d00c              BEQ      |L13.124|
;;;603              if ((int)Index == pObj->Sel) {
000062  6ee0              LDR      r0,[r4,#0x6c]
000064  42a8              CMP      r0,r5
000066  d109              BNE      |L13.124|
;;;604                _CloseSubmenu(hObj, pObj);
000068  4621              MOV      r1,r4
00006a  4638              MOV      r0,r7
00006c  f7fffffe          BL       _CloseSubmenu
;;;605                pObj->Flags &= ~MENU_SF_ACTIVE;
000070  f8b4005e          LDRH     r0,[r4,#0x5e]
000074  f0200040          BIC      r0,r0,#0x40
000078  f8a4005e          STRH     r0,[r4,#0x5e]
                  |L13.124|
;;;606              }
;;;607            }
;;;608          }
;;;609        }
;;;610      }
00007c  bf00              NOP      
                  |L13.126|
;;;611    }
00007e  e8bd81f0          POP      {r4-r8,pc}
;;;612    
                          ENDP


                          AREA ||i._CalcMenuSizeX||, CODE, READONLY, ALIGN=1

                  _CalcMenuSizeX PROC
;;;282    */
;;;283    static int _CalcMenuSizeX(MENU_Handle hObj, MENU_Obj* pObj) {
000000  e92d47f0          PUSH     {r4-r10,lr}
000004  4681              MOV      r9,r0
000006  460f              MOV      r7,r1
;;;284      unsigned i, NumItems = MENU__GetNumItems(pObj);
000008  4638              MOV      r0,r7
00000a  f7fffffe          BL       MENU__GetNumItems
00000e  4680              MOV      r8,r0
;;;285      int xSize = 0;
000010  2500              MOVS     r5,#0
;;;286      if (pObj->Flags & MENU_SF_VERTICAL) {
000012  f897005e          LDRB     r0,[r7,#0x5e]
000016  f0100f01          TST      r0,#1
00001a  d00e              BEQ      |L14.58|
;;;287        int ItemWidth;
;;;288        for (i = 0; i < NumItems; i++) {
00001c  2400              MOVS     r4,#0
00001e  e009              B        |L14.52|
                  |L14.32|
;;;289          ItemWidth = _GetItemWidth(hObj, pObj, i);
000020  4622              MOV      r2,r4
000022  4639              MOV      r1,r7
000024  4648              MOV      r0,r9
000026  f7fffffe          BL       _GetItemWidth
00002a  4606              MOV      r6,r0
;;;290          if (ItemWidth > xSize) {
00002c  42ae              CMP      r6,r5
00002e  dd00              BLE      |L14.50|
;;;291            xSize = ItemWidth;
000030  4635              MOV      r5,r6
                  |L14.50|
000032  1c64              ADDS     r4,r4,#1              ;288
                  |L14.52|
000034  4544              CMP      r4,r8                 ;288
000036  d3f3              BCC      |L14.32|
;;;292          }
;;;293        }
;;;294      } else {
000038  e00a              B        |L14.80|
                  |L14.58|
;;;295        for (i = 0; i < NumItems; i++) {
00003a  2400              MOVS     r4,#0
00003c  e006              B        |L14.76|
                  |L14.62|
;;;296          xSize += _GetItemWidth(hObj, pObj, i);
00003e  4622              MOV      r2,r4
000040  4639              MOV      r1,r7
000042  4648              MOV      r0,r9
000044  f7fffffe          BL       _GetItemWidth
000048  4405              ADD      r5,r5,r0
00004a  1c64              ADDS     r4,r4,#1              ;295
                  |L14.76|
00004c  4544              CMP      r4,r8                 ;295
00004e  d3f6              BCC      |L14.62|
                  |L14.80|
;;;297        }
;;;298      }
;;;299      xSize += (_GetEffectSize(hObj, pObj) << 1);
000050  4639              MOV      r1,r7
000052  4648              MOV      r0,r9
000054  f7fffffe          BL       _GetEffectSize
000058  eb050540          ADD      r5,r5,r0,LSL #1
;;;300      return xSize;
00005c  4628              MOV      r0,r5
;;;301    }
00005e  e8bd87f0          POP      {r4-r10,pc}
;;;302    
                          ENDP


                          AREA ||i._CalcMenuSizeY||, CODE, READONLY, ALIGN=1

                  _CalcMenuSizeY PROC
;;;306    */
;;;307    static int _CalcMenuSizeY(MENU_Handle hObj, MENU_Obj* pObj) {
000000  e92d47f0          PUSH     {r4-r10,lr}
000004  4681              MOV      r9,r0
000006  460f              MOV      r7,r1
;;;308      unsigned i, NumItems = MENU__GetNumItems(pObj);
000008  4638              MOV      r0,r7
00000a  f7fffffe          BL       MENU__GetNumItems
00000e  4680              MOV      r8,r0
;;;309      int ySize = 0;
000010  2500              MOVS     r5,#0
;;;310      if (pObj->Flags & MENU_SF_VERTICAL) {
000012  f897005e          LDRB     r0,[r7,#0x5e]
000016  f0100f01          TST      r0,#1
00001a  d00b              BEQ      |L15.52|
;;;311        for (i = 0; i < NumItems; i++) {
00001c  2400              MOVS     r4,#0
00001e  e006              B        |L15.46|
                  |L15.32|
;;;312          ySize += _GetItemHeight(hObj, pObj, i);
000020  4622              MOV      r2,r4
000022  4639              MOV      r1,r7
000024  4648              MOV      r0,r9
000026  f7fffffe          BL       _GetItemHeight
00002a  4405              ADD      r5,r5,r0
00002c  1c64              ADDS     r4,r4,#1              ;311
                  |L15.46|
00002e  4544              CMP      r4,r8                 ;311
000030  d3f6              BCC      |L15.32|
000032  e00e              B        |L15.82|
                  |L15.52|
;;;313        }
;;;314      } else {
;;;315        int ItemHeight;
;;;316        for (i = 0; i < NumItems; i++) {
000034  2400              MOVS     r4,#0
000036  e009              B        |L15.76|
                  |L15.56|
;;;317          ItemHeight = _GetItemHeight(hObj, pObj, i);
000038  4622              MOV      r2,r4
00003a  4639              MOV      r1,r7
00003c  4648              MOV      r0,r9
00003e  f7fffffe          BL       _GetItemHeight
000042  4606              MOV      r6,r0
;;;318          if (ItemHeight > ySize) {
000044  42ae              CMP      r6,r5
000046  dd00              BLE      |L15.74|
;;;319            ySize = ItemHeight;
000048  4635              MOV      r5,r6
                  |L15.74|
00004a  1c64              ADDS     r4,r4,#1              ;316
                  |L15.76|
00004c  4544              CMP      r4,r8                 ;316
00004e  d3f3              BCC      |L15.56|
;;;320          }
;;;321        }
;;;322      }
000050  bf00              NOP      
                  |L15.82|
;;;323      ySize += (_GetEffectSize(hObj, pObj) << 1);
000052  4639              MOV      r1,r7
000054  4648              MOV      r0,r9
000056  f7fffffe          BL       _GetEffectSize
00005a  eb050540          ADD      r5,r5,r0,LSL #1
;;;324      return ySize;
00005e  4628              MOV      r0,r5
;;;325    }
000060  e8bd87f0          POP      {r4-r10,pc}
;;;326    
                          ENDP


                          AREA ||i._CalcTextWidth||, CODE, READONLY, ALIGN=1

                  _CalcTextWidth PROC
;;;226    */
;;;227    static int _CalcTextWidth(MENU_Obj* pObj, const char GUI_UNI_PTR* sText) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  4605              MOV      r5,r0
000006  460c              MOV      r4,r1
;;;228      int TextWidth = 0;
000008  2600              MOVS     r6,#0
;;;229      if (sText) {
00000a  b15c              CBZ      r4,|L16.36|
;;;230        const GUI_FONT GUI_UNI_PTR* pOldFont;
;;;231        pOldFont  = GUI_SetFont(pObj->Props.pFont);
00000c  6d68              LDR      r0,[r5,#0x54]
00000e  f7fffffe          BL       GUI_SetFont
000012  4607              MOV      r7,r0
;;;232        TextWidth = GUI_GetStringDistX(sText);
000014  4620              MOV      r0,r4
000016  f7fffffe          BL       GUI_GetStringDistX
00001a  4606              MOV      r6,r0
;;;233        GUI_SetFont(pOldFont);
00001c  4638              MOV      r0,r7
00001e  f7fffffe          BL       GUI_SetFont
;;;234      }
000022  bf00              NOP      
                  |L16.36|
;;;235      return TextWidth;
000024  4630              MOV      r0,r6
;;;236    }
000026  e8bd81f0          POP      {r4-r8,pc}
;;;237    
                          ENDP


                          AREA ||i._CalcWindowSizeX||, CODE, READONLY, ALIGN=1

                  _CalcWindowSizeX PROC
;;;330    */
;;;331    static int _CalcWindowSizeX(MENU_Handle hObj, MENU_Obj* pObj) {
000000  b570              PUSH     {r4-r6,lr}
000002  4606              MOV      r6,r0
000004  460c              MOV      r4,r1
;;;332      int xSize = pObj->Width;
000006  6e65              LDR      r5,[r4,#0x64]
;;;333      if (xSize == 0) {
000008  b925              CBNZ     r5,|L17.20|
;;;334        xSize = _CalcMenuSizeX(hObj, pObj);
00000a  4621              MOV      r1,r4
00000c  4630              MOV      r0,r6
00000e  f7fffffe          BL       _CalcMenuSizeX
000012  4605              MOV      r5,r0
                  |L17.20|
;;;335      }
;;;336      return xSize;
000014  4628              MOV      r0,r5
;;;337    }
000016  bd70              POP      {r4-r6,pc}
;;;338    
                          ENDP


                          AREA ||i._CalcWindowSizeY||, CODE, READONLY, ALIGN=1

                  _CalcWindowSizeY PROC
;;;342    */
;;;343    static int _CalcWindowSizeY(MENU_Handle hObj, MENU_Obj* pObj) {
000000  b570              PUSH     {r4-r6,lr}
000002  4606              MOV      r6,r0
000004  460c              MOV      r4,r1
;;;344      int ySize = pObj->Height;
000006  6ea5              LDR      r5,[r4,#0x68]
;;;345      if (ySize == 0) {
000008  b925              CBNZ     r5,|L18.20|
;;;346        ySize = _CalcMenuSizeY(hObj, pObj);
00000a  4621              MOV      r1,r4
00000c  4630              MOV      r0,r6
00000e  f7fffffe          BL       _CalcMenuSizeY
000012  4605              MOV      r5,r0
                  |L18.20|
;;;347      }
;;;348      return ySize;
000014  4628              MOV      r0,r5
;;;349    }
000016  bd70              POP      {r4-r6,pc}
;;;350    
                          ENDP


                          AREA ||i._ClosePopup||, CODE, READONLY, ALIGN=1

                  _ClosePopup PROC
;;;528    */
;;;529    static void _ClosePopup(MENU_Handle hObj, MENU_Obj* pObj) {
000000  b570              PUSH     {r4-r6,lr}
000002  4605              MOV      r5,r0
000004  460c              MOV      r4,r1
;;;530      if (pObj->Flags & MENU_SF_POPUP) {
000006  f894005e          LDRB     r0,[r4,#0x5e]
00000a  f0100f80          TST      r0,#0x80
00000e  d00a              BEQ      |L19.38|
;;;531        pObj->Flags &= ~(MENU_SF_POPUP);
000010  f8b4005e          LDRH     r0,[r4,#0x5e]
000014  f0200080          BIC      r0,r0,#0x80
000018  f8a4005e          STRH     r0,[r4,#0x5e]
;;;532        WM_DetachWindow(hObj);
00001c  4628              MOV      r0,r5
00001e  f7fffffe          BL       WM_DetachWindow
;;;533        WM_ReleaseCapture();
000022  f7fffffe          BL       WM_ReleaseCapture
                  |L19.38|
;;;534      }
;;;535    }
000026  bd70              POP      {r4-r6,pc}
;;;536    
                          ENDP


                          AREA ||i._CloseSubmenu||, CODE, READONLY, ALIGN=1

                  _CloseSubmenu PROC
;;;453    */
;;;454    static void _CloseSubmenu(MENU_Handle hObj, MENU_Obj* pObj) {
000000  b570              PUSH     {r4-r6,lr}
000002  4606              MOV      r6,r0
000004  460c              MOV      r4,r1
;;;455      if (pObj->Flags & MENU_SF_ACTIVE) {
000006  f894005e          LDRB     r0,[r4,#0x5e]
00000a  f0100f40          TST      r0,#0x40
00000e  d020              BEQ      |L20.82|
;;;456        if (pObj->IsSubmenuActive) {
000010  f8940060          LDRB     r0,[r4,#0x60]
000014  b1e8              CBZ      r0,|L20.82|
;;;457          MENU_ITEM* pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, pObj->Sel);
000016  f1040058          ADD      r0,r4,#0x58
00001a  6ee1              LDR      r1,[r4,#0x6c]
00001c  f7fffffe          BL       GUI_ARRAY_GetpItem
000020  4605              MOV      r5,r0
;;;458          /* Inform submenu about its deactivation and detach it */
;;;459          MENU__SendMenuMessage(hObj, pItem->hSubmenu, MENU_ON_CLOSE, 0);
000022  f9b51000          LDRSH    r1,[r5,#0]
000026  2300              MOVS     r3,#0
000028  2204              MOVS     r2,#4
00002a  4630              MOV      r0,r6
00002c  f7fffffe          BL       MENU__SendMenuMessage
;;;460          WM_DetachWindow(pItem->hSubmenu);
000030  f9b50000          LDRSH    r0,[r5,#0]
000034  f7fffffe          BL       WM_DetachWindow
;;;461          pObj->IsSubmenuActive = 0;
000038  2000              MOVS     r0,#0
00003a  f8840060          STRB     r0,[r4,#0x60]
;;;462          /*
;;;463           * Keep capture in menu widget. The capture may only released
;;;464           * by clicking outside the menu or when mouse moved out.
;;;465           * And it may only released from a top level menu.
;;;466           */
;;;467          _SetCapture(hObj, pObj);
00003e  4621              MOV      r1,r4
000040  4630              MOV      r0,r6
000042  f7fffffe          BL       _SetCapture
;;;468          /* Invalidate menu item. This is needed because the appearance may have changed */
;;;469          MENU__InvalidateItem(hObj, pObj, pObj->Sel);
000046  4621              MOV      r1,r4
000048  4630              MOV      r0,r6
00004a  6ee2              LDR      r2,[r4,#0x6c]
00004c  f7fffffe          BL       MENU__InvalidateItem
;;;470        }
000050  bf00              NOP      
                  |L20.82|
;;;471      }
;;;472    }
000052  bd70              POP      {r4-r6,pc}
;;;473    
                          ENDP


                          AREA ||i._DeactivateMenu||, CODE, READONLY, ALIGN=1

                  _DeactivateMenu PROC
;;;616    */
;;;617    static void _DeactivateMenu(MENU_Handle hObj, MENU_Obj* pObj) {
000000  b570              PUSH     {r4-r6,lr}
000002  4605              MOV      r5,r0
000004  460c              MOV      r4,r1
;;;618      _CloseSubmenu(hObj, pObj);
000006  4621              MOV      r1,r4
000008  4628              MOV      r0,r5
00000a  f7fffffe          BL       _CloseSubmenu
;;;619      if ((pObj->Flags & MENU_SF_OPEN_ON_POINTEROVER) == 0) {
00000e  f894005e          LDRB     r0,[r4,#0x5e]
000012  f0100f02          TST      r0,#2
000016  d105              BNE      |L21.36|
;;;620        pObj->Flags &= ~MENU_SF_ACTIVE;
000018  f8b4005e          LDRH     r0,[r4,#0x5e]
00001c  f0200040          BIC      r0,r0,#0x40
000020  f8a4005e          STRH     r0,[r4,#0x5e]
                  |L21.36|
;;;621      }
;;;622    }
000024  bd70              POP      {r4-r6,pc}
;;;623    
                          ENDP


                          AREA ||i._DeselectItem||, CODE, READONLY, ALIGN=1

                  _DeselectItem PROC
;;;564    */
;;;565    static void _DeselectItem(MENU_Handle hObj, MENU_Obj* pObj) {
000000  b570              PUSH     {r4-r6,lr}
000002  4605              MOV      r5,r0
000004  460c              MOV      r4,r1
;;;566      if (pObj->IsSubmenuActive == 0) {
000006  f8940060          LDRB     r0,[r4,#0x60]
00000a  b948              CBNZ     r0,|L22.32|
;;;567        _SetSelection(hObj, pObj, -1);
00000c  f04f32ff          MOV      r2,#0xffffffff
000010  4621              MOV      r1,r4
000012  4628              MOV      r0,r5
000014  f7fffffe          BL       _SetSelection
;;;568        _ReleaseCapture(hObj, pObj);
000018  4621              MOV      r1,r4
00001a  4628              MOV      r0,r5
00001c  f7fffffe          BL       _ReleaseCapture
                  |L22.32|
;;;569      }
;;;570    }
000020  bd70              POP      {r4-r6,pc}
;;;571    
                          ENDP


                          AREA ||i._ForwardPIDMsgToOwner||, CODE, READONLY, ALIGN=1

                  _ForwardPIDMsgToOwner PROC
;;;760    */
;;;761    static void _ForwardPIDMsgToOwner(MENU_Handle hObj, MENU_Obj* pObj, WM_MESSAGE* pMsg) {
000000  e92d47f0          PUSH     {r4-r10,lr}
000004  4680              MOV      r8,r0
000006  460e              MOV      r6,r1
000008  4614              MOV      r4,r2
;;;762      if (_IsTopLevelMenu(hObj, pObj) == 0) {
00000a  4631              MOV      r1,r6
00000c  4640              MOV      r0,r8
00000e  f7fffffe          BL       _IsTopLevelMenu
000012  bb58              CBNZ     r0,|L23.108|
;;;763        WM_HWIN hOwner;
;;;764        hOwner = pObj->hOwner ? pObj->hOwner : WM_GetParent(hObj);
000014  f8b6005c          LDRH     r0,[r6,#0x5c]
000018  b110              CBZ      r0,|L23.32|
00001a  f9b6005c          LDRSH    r0,[r6,#0x5c]
00001e  e002              B        |L23.38|
                  |L23.32|
000020  4640              MOV      r0,r8
000022  f7fffffe          BL       WM_GetParent
                  |L23.38|
000026  4607              MOV      r7,r0
;;;765        if (hOwner) {
000028  b1ff              CBZ      r7,|L23.106|
;;;766          if (pMsg->Data.p) {
00002a  68a0              LDR      r0,[r4,#8]
00002c  b1c8              CBZ      r0,|L23.98|
;;;767            GUI_PID_STATE* pState;
;;;768            pState = (GUI_PID_STATE*)pMsg->Data.p;
00002e  68a5              LDR      r5,[r4,#8]
;;;769            pState->x += WM_GetWindowOrgX(hObj) - WM_GetWindowOrgX(hOwner);
000030  4640              MOV      r0,r8
000032  f7fffffe          BL       WM_GetWindowOrgX
000036  4681              MOV      r9,r0
000038  4638              MOV      r0,r7
00003a  f7fffffe          BL       WM_GetWindowOrgX
00003e  eba90000          SUB      r0,r9,r0
000042  6829              LDR      r1,[r5,#0]
000044  4408              ADD      r0,r0,r1
000046  6028              STR      r0,[r5,#0]
;;;770            pState->y += WM_GetWindowOrgY(hObj) - WM_GetWindowOrgY(hOwner);
000048  4640              MOV      r0,r8
00004a  f7fffffe          BL       WM_GetWindowOrgY
00004e  4681              MOV      r9,r0
000050  4638              MOV      r0,r7
000052  f7fffffe          BL       WM_GetWindowOrgY
000056  eba90000          SUB      r0,r9,r0
00005a  6869              LDR      r1,[r5,#4]
00005c  4408              ADD      r0,r0,r1
00005e  6068              STR      r0,[r5,#4]
;;;771          }
000060  bf00              NOP      
                  |L23.98|
;;;772          WM__SendMessage(hOwner, pMsg);
000062  4621              MOV      r1,r4
000064  4638              MOV      r0,r7
000066  f7fffffe          BL       WM__SendMessage
                  |L23.106|
;;;773        }
;;;774      }
00006a  bf00              NOP      
                  |L23.108|
;;;775    }
00006c  e8bd87f0          POP      {r4-r10,pc}
;;;776    
                          ENDP


                          AREA ||i._GetEffectSize||, CODE, READONLY, ALIGN=1

                  _GetEffectSize PROC
;;;214    */
;;;215    static int _GetEffectSize(MENU_Handle hObj, MENU_Obj* pObj) {
000000  b570              PUSH     {r4-r6,lr}
000002  4605              MOV      r5,r0
000004  460c              MOV      r4,r1
;;;216      int r = 0;
000006  2600              MOVS     r6,#0
;;;217      if (_HasEffect(hObj, pObj)) { 
000008  4621              MOV      r1,r4
00000a  4628              MOV      r0,r5
00000c  f7fffffe          BL       _HasEffect
000010  b108              CBZ      r0,|L24.22|
;;;218        r = pObj->Widget.pEffect->EffectSize;
000012  6a20              LDR      r0,[r4,#0x20]
000014  6946              LDR      r6,[r0,#0x14]
                  |L24.22|
;;;219      }
;;;220      return r;
000016  4630              MOV      r0,r6
;;;221    }
000018  bd70              POP      {r4-r6,pc}
;;;222    
                          ENDP


                          AREA ||i._GetItemFromPos||, CODE, READONLY, ALIGN=1

                  _GetItemFromPos PROC
;;;361    */
;;;362    static int _GetItemFromPos(MENU_Handle hObj, MENU_Obj* pObj, int x, int y) {
000000  e92d4fff          PUSH     {r0-r11,lr}
000004  b083              SUB      sp,sp,#0xc
000006  460c              MOV      r4,r1
000008  4617              MOV      r7,r2
00000a  4698              MOV      r8,r3
;;;363      int xSize, ySize, EffectSize, r = -1;
00000c  f04f30ff          MOV      r0,#0xffffffff
000010  9002              STR      r0,[sp,#8]
;;;364      ySize = _CalcMenuSizeY(hObj, pObj);
000012  4621              MOV      r1,r4
000014  9803              LDR      r0,[sp,#0xc]
000016  f7fffffe          BL       _CalcMenuSizeY
00001a  4682              MOV      r10,r0
;;;365      if ((pObj->Height) && (pObj->Height < ySize)) {
00001c  6ea0              LDR      r0,[r4,#0x68]
00001e  b120              CBZ      r0,|L25.42|
000020  6ea0              LDR      r0,[r4,#0x68]
000022  4550              CMP      r0,r10
000024  da01              BGE      |L25.42|
;;;366        ySize = pObj->Height;
000026  f8d4a068          LDR      r10,[r4,#0x68]
                  |L25.42|
;;;367      }
;;;368      xSize = _CalcMenuSizeX(hObj, pObj);
00002a  4621              MOV      r1,r4
00002c  9803              LDR      r0,[sp,#0xc]
00002e  f7fffffe          BL       _CalcMenuSizeX
000032  4681              MOV      r9,r0
;;;369      if ((pObj->Width) && (pObj->Width < xSize)) {
000034  6e60              LDR      r0,[r4,#0x64]
000036  b120              CBZ      r0,|L25.66|
000038  6e60              LDR      r0,[r4,#0x64]
00003a  4548              CMP      r0,r9
00003c  da01              BGE      |L25.66|
;;;370        xSize = pObj->Width;
00003e  f8d49064          LDR      r9,[r4,#0x64]
                  |L25.66|
;;;371      }
;;;372      EffectSize = _GetEffectSize(hObj, pObj);
000042  4621              MOV      r1,r4
000044  9803              LDR      r0,[sp,#0xc]
000046  f7fffffe          BL       _GetEffectSize
00004a  4606              MOV      r6,r0
;;;373      x     -= EffectSize;
00004c  1bbf              SUBS     r7,r7,r6
;;;374      y     -= EffectSize;
00004e  eba80806          SUB      r8,r8,r6
;;;375      xSize -= (EffectSize << 1);
000052  eba90946          SUB      r9,r9,r6,LSL #1
;;;376      ySize -= (EffectSize << 1);
000056  ebaa0a46          SUB      r10,r10,r6,LSL #1
;;;377      if ((x >= 0) && (y >= 0) && (x < xSize) && (y < ySize)) {
00005a  2f00              CMP      r7,#0
00005c  db38              BLT      |L25.208|
00005e  f1b80f00          CMP      r8,#0
000062  db35              BLT      |L25.208|
000064  454f              CMP      r7,r9
000066  da33              BGE      |L25.208|
000068  45d0              CMP      r8,r10
00006a  da31              BGE      |L25.208|
;;;378        unsigned i, NumItems = MENU__GetNumItems(pObj);
00006c  4620              MOV      r0,r4
00006e  f7fffffe          BL       MENU__GetNumItems
000072  9001              STR      r0,[sp,#4]
;;;379        if (pObj->Flags & MENU_SF_VERTICAL) {
000074  f894005e          LDRB     r0,[r4,#0x5e]
000078  f0100f01          TST      r0,#1
00007c  d013              BEQ      |L25.166|
;;;380          int yPos = 0;
00007e  f04f0b00          MOV      r11,#0
;;;381          for (i = 0; i < NumItems; i++) {
000082  2500              MOVS     r5,#0
000084  e00a              B        |L25.156|
                  |L25.134|
;;;382            yPos += _GetItemHeight(hObj, pObj, i);
000086  462a              MOV      r2,r5
000088  4621              MOV      r1,r4
00008a  9803              LDR      r0,[sp,#0xc]
00008c  f7fffffe          BL       _GetItemHeight
000090  4483              ADD      r11,r11,r0
;;;383            if (y < yPos) {
000092  45d8              CMP      r8,r11
000094  da01              BGE      |L25.154|
;;;384              r = i;
000096  9502              STR      r5,[sp,#8]
;;;385              break;
000098  e003              B        |L25.162|
                  |L25.154|
00009a  1c6d              ADDS     r5,r5,#1              ;381
                  |L25.156|
00009c  9801              LDR      r0,[sp,#4]            ;381
00009e  4285              CMP      r5,r0                 ;381
0000a0  d3f1              BCC      |L25.134|
                  |L25.162|
0000a2  bf00              NOP      
;;;386            }
;;;387          }
;;;388        } else {
0000a4  e013              B        |L25.206|
                  |L25.166|
;;;389          int xPos = 0;
0000a6  f04f0b00          MOV      r11,#0
;;;390          for (i = 0; i < NumItems; i++) {
0000aa  2500              MOVS     r5,#0
0000ac  e00a              B        |L25.196|
                  |L25.174|
;;;391            xPos += _GetItemWidth(hObj, pObj, i);
0000ae  462a              MOV      r2,r5
0000b0  4621              MOV      r1,r4
0000b2  9803              LDR      r0,[sp,#0xc]
0000b4  f7fffffe          BL       _GetItemWidth
0000b8  4483              ADD      r11,r11,r0
;;;392            if (x < xPos) {
0000ba  455f              CMP      r7,r11
0000bc  da01              BGE      |L25.194|
;;;393              r = i;
0000be  9502              STR      r5,[sp,#8]
;;;394              break;
0000c0  e003              B        |L25.202|
                  |L25.194|
0000c2  1c6d              ADDS     r5,r5,#1              ;390
                  |L25.196|
0000c4  9801              LDR      r0,[sp,#4]            ;390
0000c6  4285              CMP      r5,r0                 ;390
0000c8  d3f1              BCC      |L25.174|
                  |L25.202|
0000ca  bf00              NOP      
;;;395            }
;;;396          }
;;;397        }
0000cc  bf00              NOP      
                  |L25.206|
;;;398      }
0000ce  bf00              NOP      
                  |L25.208|
;;;399      return r;
0000d0  9802              LDR      r0,[sp,#8]
;;;400    }
0000d2  b007              ADD      sp,sp,#0x1c
0000d4  e8bd8ff0          POP      {r4-r11,pc}
;;;401    
                          ENDP


                          AREA ||i._GetItemHeight||, CODE, READONLY, ALIGN=1

                  _GetItemHeight PROC
;;;261    */
;;;262    static int _GetItemHeight(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  4607              MOV      r7,r0
000006  460c              MOV      r4,r1
000008  4616              MOV      r6,r2
;;;263      int ItemHeight;
;;;264      if (pObj->Height && !(pObj->Flags & MENU_SF_VERTICAL)) {
00000a  6ea0              LDR      r0,[r4,#0x68]
00000c  b160              CBZ      r0,|L26.40|
00000e  f894005e          LDRB     r0,[r4,#0x5e]
000012  f0100f01          TST      r0,#1
000016  d107              BNE      |L26.40|
;;;265        ItemHeight = pObj->Height - (_GetEffectSize(hObj, pObj) << 1);
000018  4621              MOV      r1,r4
00001a  4638              MOV      r0,r7
00001c  f7fffffe          BL       _GetEffectSize
000020  6ea1              LDR      r1,[r4,#0x68]
000022  eba10540          SUB      r5,r1,r0,LSL #1
000026  e01b              B        |L26.96|
                  |L26.40|
;;;266      } else {
;;;267        ItemHeight = GUI_GetYDistOfFont(pObj->Props.pFont);
000028  6d60              LDR      r0,[r4,#0x54]
00002a  f7fffffe          BL       GUI_GetYDistOfFont
00002e  4605              MOV      r5,r0
;;;268        if (pObj->Flags & MENU_SF_VERTICAL) {
000030  f894005e          LDRB     r0,[r4,#0x5e]
000034  f0100f01          TST      r0,#1
000038  d00c              BEQ      |L26.84|
;;;269          MENU_ITEM* pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
00003a  4631              MOV      r1,r6
00003c  f1040058          ADD      r0,r4,#0x58
000040  f7fffffe          BL       GUI_ARRAY_GetpItem
000044  4680              MOV      r8,r0
;;;270          if (pItem->Flags & MENU_IF_SEPARATOR) {
000046  f8980004          LDRB     r0,[r8,#4]
00004a  f0100f02          TST      r0,#2
00004e  d000              BEQ      |L26.82|
;;;271            ItemHeight = 3;
000050  2503              MOVS     r5,#3
                  |L26.82|
;;;272          }
;;;273        }
000052  bf00              NOP      
                  |L26.84|
;;;274        ItemHeight += pObj->Props.aBorder[MENU_BI_TOP] + pObj->Props.aBorder[MENU_BI_BOTTOM];
000054  f8941052          LDRB     r1,[r4,#0x52]
000058  f8940053          LDRB     r0,[r4,#0x53]
00005c  4408              ADD      r0,r0,r1
00005e  4405              ADD      r5,r5,r0
                  |L26.96|
;;;275      }
;;;276      return ItemHeight;
000060  4628              MOV      r0,r5
;;;277    }
000062  e8bd81f0          POP      {r4-r8,pc}
;;;278    
                          ENDP


                          AREA ||i._GetItemPos||, CODE, READONLY, ALIGN=1

                  _GetItemPos PROC
;;;405    */
;;;406    static void _GetItemPos(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index, int* px, int* py) {
000000  e92d5ff0          PUSH     {r4-r12,lr}
000004  4683              MOV      r11,r0
000006  4688              MOV      r8,r1
000008  4616              MOV      r6,r2
00000a  461f              MOV      r7,r3
00000c  f8dd9028          LDR      r9,[sp,#0x28]
;;;407      int i, EffectSize;
;;;408      EffectSize = _GetEffectSize(hObj, pObj);
000010  4641              MOV      r1,r8
000012  4658              MOV      r0,r11
000014  f7fffffe          BL       _GetEffectSize
000018  4605              MOV      r5,r0
;;;409      if (pObj->Flags & MENU_SF_VERTICAL) {
00001a  f898005e          LDRB     r0,[r8,#0x5e]
00001e  f0100f01          TST      r0,#1
000022  d012              BEQ      |L27.74|
;;;410        int yPos = 0;
000024  f04f0a00          MOV      r10,#0
;;;411        for (i = 0; i < (int)Index; i++) {
000028  2400              MOVS     r4,#0
00002a  e006              B        |L27.58|
                  |L27.44|
;;;412          yPos += _GetItemHeight(hObj, pObj, i);
00002c  4622              MOV      r2,r4
00002e  4641              MOV      r1,r8
000030  4658              MOV      r0,r11
000032  f7fffffe          BL       _GetItemHeight
000036  4482              ADD      r10,r10,r0
000038  1c64              ADDS     r4,r4,#1              ;411
                  |L27.58|
00003a  42b4              CMP      r4,r6                 ;411
00003c  dbf6              BLT      |L27.44|
;;;413        }
;;;414        *px = EffectSize;
00003e  603d              STR      r5,[r7,#0]
;;;415        *py = EffectSize + yPos;
000040  eb05000a          ADD      r0,r5,r10
000044  f8c90000          STR      r0,[r9,#0]
;;;416      } else {
000048  e012              B        |L27.112|
                  |L27.74|
;;;417        int xPos = 0;
00004a  f04f0a00          MOV      r10,#0
;;;418        for (i = 0; i < (int)Index; i++) {
00004e  2400              MOVS     r4,#0
000050  e006              B        |L27.96|
                  |L27.82|
;;;419          xPos += _GetItemWidth(hObj, pObj, i);
000052  4622              MOV      r2,r4
000054  4641              MOV      r1,r8
000056  4658              MOV      r0,r11
000058  f7fffffe          BL       _GetItemWidth
00005c  4482              ADD      r10,r10,r0
00005e  1c64              ADDS     r4,r4,#1              ;418
                  |L27.96|
000060  42b4              CMP      r4,r6                 ;418
000062  dbf6              BLT      |L27.82|
;;;420        }
;;;421        *px = EffectSize + xPos;
000064  eb05000a          ADD      r0,r5,r10
000068  6038              STR      r0,[r7,#0]
;;;422        *py = EffectSize;
00006a  f8c95000          STR      r5,[r9,#0]
;;;423      }
00006e  bf00              NOP      
                  |L27.112|
;;;424    }
000070  e8bd9ff0          POP      {r4-r12,pc}
;;;425    
                          ENDP


                          AREA ||i._GetItemWidth||, CODE, READONLY, ALIGN=1

                  _GetItemWidth PROC
;;;241    */
;;;242    static int _GetItemWidth(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  4680              MOV      r8,r0
000006  460c              MOV      r4,r1
000008  4616              MOV      r6,r2
;;;243      int ItemWidth;
;;;244      if (pObj->Width && (pObj->Flags & MENU_SF_VERTICAL)) {
00000a  6e60              LDR      r0,[r4,#0x64]
00000c  b160              CBZ      r0,|L28.40|
00000e  f894005e          LDRB     r0,[r4,#0x5e]
000012  f0100f01          TST      r0,#1
000016  d007              BEQ      |L28.40|
;;;245        ItemWidth = pObj->Width - (_GetEffectSize(hObj, pObj) << 1);
000018  4621              MOV      r1,r4
00001a  4640              MOV      r0,r8
00001c  f7fffffe          BL       _GetEffectSize
000020  6e61              LDR      r1,[r4,#0x64]
000022  eba10540          SUB      r5,r1,r0,LSL #1
000026  e018              B        |L28.90|
                  |L28.40|
;;;246      } else {
;;;247        MENU_ITEM* pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
000028  4631              MOV      r1,r6
00002a  f1040058          ADD      r0,r4,#0x58
00002e  f7fffffe          BL       GUI_ARRAY_GetpItem
000032  4607              MOV      r7,r0
;;;248        if ((pObj->Flags & MENU_SF_VERTICAL) || !(pItem->Flags & MENU_IF_SEPARATOR)) {
000034  f894005e          LDRB     r0,[r4,#0x5e]
000038  f0100f01          TST      r0,#1
00003c  d103              BNE      |L28.70|
00003e  7938              LDRB     r0,[r7,#4]
000040  f0100f02          TST      r0,#2
000044  d101              BNE      |L28.74|
                  |L28.70|
;;;249          ItemWidth = pItem->TextWidth;
000046  68bd              LDR      r5,[r7,#8]
000048  e000              B        |L28.76|
                  |L28.74|
;;;250        } else {
;;;251          ItemWidth = 3;
00004a  2503              MOVS     r5,#3
                  |L28.76|
;;;252       }
;;;253        ItemWidth += pObj->Props.aBorder[MENU_BI_LEFT] + pObj->Props.aBorder[MENU_BI_RIGHT];
00004c  f8941050          LDRB     r1,[r4,#0x50]
000050  f8940051          LDRB     r0,[r4,#0x51]
000054  4408              ADD      r0,r0,r1
000056  4405              ADD      r5,r5,r0
;;;254      }
000058  bf00              NOP      
                  |L28.90|
;;;255      return ItemWidth;
00005a  4628              MOV      r0,r5
;;;256    }
00005c  e8bd81f0          POP      {r4-r8,pc}
;;;257    
                          ENDP


                          AREA ||i._GetTopLevelMenu||, CODE, READONLY, ALIGN=1

                  _GetTopLevelMenu PROC
;;;173    */
;;;174    static void _GetTopLevelMenu(MENU_Handle hObj, MENU_Obj * pObj, MENU_Handle * phObjTopLevel, MENU_Obj ** ppObjTopLevel, int * pSubSel) {
000000  e92d47f0          PUSH     {r4-r10,lr}
000004  4682              MOV      r10,r0
000006  460e              MOV      r6,r1
000008  4617              MOV      r7,r2
00000a  4698              MOV      r8,r3
00000c  f8dd9020          LDR      r9,[sp,#0x20]
;;;175      MENU_Handle hObjTopLevel;
;;;176      MENU_Obj * pObjTopLevel;
;;;177      pObjTopLevel = pObj;
000010  4635              MOV      r5,r6
;;;178      if (_IsTopLevelMenu(hObj, pObj)) {
000012  4631              MOV      r1,r6
000014  4650              MOV      r0,r10
000016  f7fffffe          BL       _IsTopLevelMenu
00001a  b110              CBZ      r0,|L29.34|
;;;179        hObjTopLevel = hObj;
00001c  4654              MOV      r4,r10
;;;180        pObjTopLevel = pObj;
00001e  4635              MOV      r5,r6
000020  e014              B        |L29.76|
                  |L29.34|
;;;181      } else {
;;;182        do {
000022  bf00              NOP      
                  |L29.36|
;;;183          hObjTopLevel = pObjTopLevel->hOwner;
000024  f9b5405c          LDRSH    r4,[r5,#0x5c]
;;;184          pObjTopLevel = (MENU_Obj *)GUI_ALLOC_h2p(hObjTopLevel);
000028  4620              MOV      r0,r4
00002a  f7fffffe          BL       GUI_ALLOC_h2p
00002e  4605              MOV      r5,r0
;;;185          if (_IsTopLevelMenu(hObjTopLevel, pObjTopLevel)) {
000030  4629              MOV      r1,r5
000032  4620              MOV      r0,r4
000034  f7fffffe          BL       _IsTopLevelMenu
000038  b100              CBZ      r0,|L29.60|
;;;186            break;
00003a  e006              B        |L29.74|
                  |L29.60|
;;;187          } else {
;;;188            if (pSubSel) {
00003c  f1b90f00          CMP      r9,#0
000040  d002              BEQ      |L29.72|
;;;189              *pSubSel = pObjTopLevel->Sel;
000042  6ee8              LDR      r0,[r5,#0x6c]
000044  f8c90000          STR      r0,[r9,#0]
                  |L29.72|
;;;190            }
;;;191          }
;;;192        } while (1);
000048  e7ec              B        |L29.36|
                  |L29.74|
00004a  bf00              NOP                            ;186
                  |L29.76|
;;;193      }
;;;194      *phObjTopLevel = hObjTopLevel;
00004c  803c              STRH     r4,[r7,#0]
;;;195      *ppObjTopLevel = pObjTopLevel;
00004e  f8c85000          STR      r5,[r8,#0]
;;;196    }
000052  e8bd87f0          POP      {r4-r10,pc}
;;;197    
                          ENDP


                          AREA ||i._HandlePID||, CODE, READONLY, ALIGN=1

                  _HandlePID PROC
;;;662    */
;;;663    static char _HandlePID(MENU_Handle hObj, MENU_Obj* pObj, int x, int y, int Pressed) {
000000  e92d47f0          PUSH     {r4-r10,lr}
000004  b086              SUB      sp,sp,#0x18
000006  4681              MOV      r9,r0
000008  460d              MOV      r5,r1
00000a  4616              MOV      r6,r2
00000c  461f              MOV      r7,r3
00000e  9c0e              LDR      r4,[sp,#0x38]
;;;664      GUI_PID_STATE PrevState;
;;;665      char XYInWidget = 0;
000010  f04f0a00          MOV      r10,#0
;;;666      WM_PID__GetPrevState(&PrevState);
000014  a803              ADD      r0,sp,#0xc
000016  f7fffffe          BL       WM_PID__GetPrevState
;;;667      /*
;;;668       * Check if coordinates are inside the widget.
;;;669       */
;;;670      if ((x >= 0) && (y >= 0)) {
00001a  2e00              CMP      r6,#0
00001c  db10              BLT      |L30.64|
00001e  2f00              CMP      r7,#0
000020  db0e              BLT      |L30.64|
;;;671        GUI_RECT r;
;;;672        WM__GetClientRectWin(&pObj->Widget.Win, &r);
000022  a901              ADD      r1,sp,#4
000024  4628              MOV      r0,r5
000026  f7fffffe          BL       WM__GetClientRectWin
;;;673        if ((x <= r.x1) && (y <= r.y1)) {
00002a  f9bd0008          LDRSH    r0,[sp,#8]
00002e  42b0              CMP      r0,r6
000030  db05              BLT      |L30.62|
000032  f9bd000a          LDRSH    r0,[sp,#0xa]
000036  42b8              CMP      r0,r7
000038  db01              BLT      |L30.62|
;;;674          XYInWidget = 1;
00003a  f04f0a01          MOV      r10,#1
                  |L30.62|
;;;675        }
;;;676      }
00003e  bf00              NOP      
                  |L30.64|
;;;677    
;;;678      if (XYInWidget) {
000040  f1ba0f00          CMP      r10,#0
000044  d04b              BEQ      |L30.222|
;;;679        int ItemIndex;
;;;680        ItemIndex = _GetItemFromPos(hObj, pObj, x, y);
000046  463b              MOV      r3,r7
000048  4632              MOV      r2,r6
00004a  4629              MOV      r1,r5
00004c  4648              MOV      r0,r9
00004e  f7fffffe          BL       _GetItemFromPos
000052  4680              MOV      r8,r0
;;;681        /* 
;;;682         * Handle PID when coordinates are inside the widget.
;;;683         */
;;;684        if (ItemIndex >= 0) {
000054  f1b80f00          CMP      r8,#0
000058  db24              BLT      |L30.164|
;;;685          /* 
;;;686           * Coordinates are inside the menu.
;;;687           */
;;;688          if (Pressed > 0) {
00005a  2c00              CMP      r4,#0
00005c  dd0f              BLE      |L30.126|
;;;689            if ((PrevState.Pressed == 0) && (Pressed == 1)) {  /* Clicked */
00005e  f89d0014          LDRB     r0,[sp,#0x14]
000062  b930              CBNZ     r0,|L30.114|
000064  2c01              CMP      r4,#1
000066  d104              BNE      |L30.114|
;;;690              _ActivateMenu(hObj, pObj, ItemIndex);
000068  4642              MOV      r2,r8
00006a  4629              MOV      r1,r5
00006c  4648              MOV      r0,r9
00006e  f7fffffe          BL       _ActivateMenu
                  |L30.114|
;;;691            }
;;;692            _SelectItem(hObj, pObj, ItemIndex);
000072  4642              MOV      r2,r8
000074  4629              MOV      r1,r5
000076  4648              MOV      r0,r9
000078  f7fffffe          BL       _SelectItem
00007c  e02b              B        |L30.214|
                  |L30.126|
;;;693          } else if ((Pressed == 0) && (PrevState.Pressed == 1)) {  /* Released */
00007e  b94c              CBNZ     r4,|L30.148|
000080  f89d0014          LDRB     r0,[sp,#0x14]
000084  2801              CMP      r0,#1
000086  d105              BNE      |L30.148|
;;;694            _ActivateItem(hObj, pObj, ItemIndex);
000088  4642              MOV      r2,r8
00008a  4629              MOV      r1,r5
00008c  4648              MOV      r0,r9
00008e  f7fffffe          BL       _ActivateItem
000092  e020              B        |L30.214|
                  |L30.148|
;;;695          } else if (Pressed < 0) {  /* Mouse moved */
000094  2c00              CMP      r4,#0
000096  da1e              BGE      |L30.214|
;;;696            #if (GUI_SUPPORT_MOUSE)
;;;697              if (_ForwardMouseOverMsg(hObj, pObj, x, y) != 0) {
;;;698                _DeselectItem(hObj, pObj);
;;;699              } else
;;;700            #endif
;;;701            {
;;;702              _SelectItem(hObj, pObj, ItemIndex);
000098  4642              MOV      r2,r8
00009a  4629              MOV      r1,r5
00009c  4648              MOV      r0,r9
00009e  f7fffffe          BL       _SelectItem
0000a2  e018              B        |L30.214|
                  |L30.164|
;;;703            }
;;;704          }
;;;705        } else {
;;;706          /* 
;;;707           * Coordinates are outside the menu but inside the widget.
;;;708           */
;;;709          if (Pressed > 0) {
0000a4  2c00              CMP      r4,#0
0000a6  dd0b              BLE      |L30.192|
;;;710            if (PrevState.Pressed == 0) {  /* Clicked */
0000a8  f89d0014          LDRB     r0,[sp,#0x14]
0000ac  b918              CBNZ     r0,|L30.182|
;;;711              /* 
;;;712               * User has clicked outside the menu. Close the active submenu.
;;;713               * The widget itself must be closed (if needed) by the owner.
;;;714               */
;;;715              _DeactivateMenu(hObj, pObj);
0000ae  4629              MOV      r1,r5
0000b0  4648              MOV      r0,r9
0000b2  f7fffffe          BL       _DeactivateMenu
                  |L30.182|
;;;716            }
;;;717            _DeselectItem(hObj, pObj);
0000b6  4629              MOV      r1,r5
0000b8  4648              MOV      r0,r9
0000ba  f7fffffe          BL       _DeselectItem
0000be  e00a              B        |L30.214|
                  |L30.192|
;;;718          } else if (Pressed < 0) {  /* Moved out or mouse moved */
0000c0  2c00              CMP      r4,#0
0000c2  da08              BGE      |L30.214|
;;;719            if (!(pObj->Widget.State & WIDGET_STATE_FOCUS)) {
0000c4  f8950026          LDRB     r0,[r5,#0x26]
0000c8  f0100f01          TST      r0,#1
0000cc  d103              BNE      |L30.214|
;;;720              _DeselectItem(hObj, pObj);
0000ce  4629              MOV      r1,r5
0000d0  4648              MOV      r0,r9
0000d2  f7fffffe          BL       _DeselectItem
                  |L30.214|
;;;721            }
;;;722          }
;;;723        }
;;;724        return 0;
0000d6  2000              MOVS     r0,#0
                  |L30.216|
;;;725      } else {
;;;726        /* 
;;;727         * Handle PID when coordinates are outside the widget.
;;;728         */
;;;729        if ((Pressed > 0) && (PrevState.Pressed == 0)) {
;;;730          /* 
;;;731           * User has clicked outside the menu. Close the active submenu.
;;;732           * The widget itself must be closed (if needed) by the owner.
;;;733           */
;;;734          _DeselectItem(hObj, pObj);
;;;735          _DeactivateMenu(hObj, pObj);
;;;736          _ClosePopup(hObj, pObj);
;;;737          _SetSelection(hObj, pObj, -1);
;;;738          if (pObj->Widget.State & WIDGET_STATE_FOCUS) {
;;;739            MENU_Handle hObjTopLevel; 
;;;740            MENU_Obj *  pObjTopLevel;
;;;741            _GetTopLevelMenu(hObj, pObj, &hObjTopLevel, &pObjTopLevel, 0);
;;;742            WM_SetFocus(hObjTopLevel);
;;;743            _SetSelection(hObjTopLevel, pObjTopLevel, -1);
;;;744            _ReleaseCapture(hObjTopLevel, pObjTopLevel);
;;;745          }
;;;746        }
;;;747        if (!(pObj->Widget.State & WIDGET_STATE_FOCUS)) {
;;;748          _DeselectItem(hObj, pObj);
;;;749        }
;;;750        #if (GUI_SUPPORT_MOUSE)
;;;751          _ForwardMouseOverMsg(hObj, pObj, x, y);
;;;752        #endif
;;;753      }
;;;754      return 1;   /* Coordinates are not in widget, we need to forward PID message to owner */
;;;755    }
0000d8  b006              ADD      sp,sp,#0x18
0000da  e8bd87f0          POP      {r4-r10,pc}
                  |L30.222|
0000de  2c00              CMP      r4,#0                 ;729
0000e0  dd32              BLE      |L30.328|
0000e2  f89d0014          LDRB     r0,[sp,#0x14]         ;729
0000e6  bb78              CBNZ     r0,|L30.328|
0000e8  4629              MOV      r1,r5                 ;734
0000ea  4648              MOV      r0,r9                 ;734
0000ec  f7fffffe          BL       _DeselectItem
0000f0  4629              MOV      r1,r5                 ;735
0000f2  4648              MOV      r0,r9                 ;735
0000f4  f7fffffe          BL       _DeactivateMenu
0000f8  4629              MOV      r1,r5                 ;736
0000fa  4648              MOV      r0,r9                 ;736
0000fc  f7fffffe          BL       _ClosePopup
000100  f04f32ff          MOV      r2,#0xffffffff        ;737
000104  4629              MOV      r1,r5                 ;737
000106  4648              MOV      r0,r9                 ;737
000108  f7fffffe          BL       _SetSelection
00010c  f8950026          LDRB     r0,[r5,#0x26]         ;738
000110  f0100f01          TST      r0,#1                 ;738
000114  d018              BEQ      |L30.328|
000116  2000              MOVS     r0,#0                 ;741
000118  ab01              ADD      r3,sp,#4              ;741
00011a  aa02              ADD      r2,sp,#8              ;741
00011c  4629              MOV      r1,r5                 ;741
00011e  9000              STR      r0,[sp,#0]            ;741
000120  4648              MOV      r0,r9                 ;741
000122  f7fffffe          BL       _GetTopLevelMenu
000126  f9bd0008          LDRSH    r0,[sp,#8]            ;742
00012a  f7fffffe          BL       WM_SetFocus
00012e  f04f32ff          MOV      r2,#0xffffffff        ;743
000132  f9bd0008          LDRSH    r0,[sp,#8]            ;743
000136  9901              LDR      r1,[sp,#4]            ;743
000138  f7fffffe          BL       _SetSelection
00013c  f9bd0008          LDRSH    r0,[sp,#8]            ;744
000140  9901              LDR      r1,[sp,#4]            ;744
000142  f7fffffe          BL       _ReleaseCapture
000146  bf00              NOP                            ;745
                  |L30.328|
000148  f8950026          LDRB     r0,[r5,#0x26]         ;747
00014c  f0100f01          TST      r0,#1                 ;747
000150  d103              BNE      |L30.346|
000152  4629              MOV      r1,r5                 ;748
000154  4648              MOV      r0,r9                 ;748
000156  f7fffffe          BL       _DeselectItem
                  |L30.346|
00015a  2001              MOVS     r0,#1                 ;754
00015c  e7bc              B        |L30.216|
;;;756    
                          ENDP


                          AREA ||i._HasEffect||, CODE, READONLY, ALIGN=1

                  _HasEffect PROC
;;;201    */
;;;202    static int _HasEffect(MENU_Handle hObj, MENU_Obj* pObj) {
000000  b570              PUSH     {r4-r6,lr}
000002  4605              MOV      r5,r0
000004  460c              MOV      r4,r1
;;;203      if (!(pObj->Flags & MENU_SF_POPUP)) {
000006  f894005e          LDRB     r0,[r4,#0x5e]
00000a  f0100f80          TST      r0,#0x80
00000e  d106              BNE      |L31.30|
;;;204        if (_IsTopLevelMenu(hObj, pObj)) {
000010  4621              MOV      r1,r4
000012  4628              MOV      r0,r5
000014  f7fffffe          BL       _IsTopLevelMenu
000018  b108              CBZ      r0,|L31.30|
;;;205          return 0;
00001a  2000              MOVS     r0,#0
                  |L31.28|
;;;206        }
;;;207      }
;;;208      return 1;
;;;209    }
00001c  bd70              POP      {r4-r6,pc}
                  |L31.30|
00001e  2001              MOVS     r0,#1                 ;208
000020  e7fc              B        |L31.28|
;;;210    
                          ENDP


                          AREA ||i._IsTopLevelMenu||, CODE, READONLY, ALIGN=1

                  _IsTopLevelMenu PROC
;;;153    */
;;;154    static char _IsTopLevelMenu(MENU_Handle hObj, const MENU_Obj* pObj) {
000000  b570              PUSH     {r4-r6,lr}
000002  4605              MOV      r5,r0
000004  460c              MOV      r4,r1
;;;155      if (MENU__SendMenuMessage(hObj, pObj->hOwner, MENU_IS_MENU, 0) == 0) {
000006  f9b4105c          LDRSH    r1,[r4,#0x5c]
00000a  2300              MOVS     r3,#0
00000c  2205              MOVS     r2,#5
00000e  4628              MOV      r0,r5
000010  f7fffffe          BL       MENU__SendMenuMessage
000014  b908              CBNZ     r0,|L32.26|
;;;156        return 1;
000016  2001              MOVS     r0,#1
                  |L32.24|
;;;157      }
;;;158      return 0;
;;;159    }
000018  bd70              POP      {r4-r6,pc}
                  |L32.26|
00001a  2000              MOVS     r0,#0                 ;158
00001c  e7fc              B        |L32.24|
;;;160    
                          ENDP


                          AREA ||i._MoveSel||, CODE, READONLY, ALIGN=1

                  _MoveSel PROC
;;;962    */
;;;963    static void _MoveSel(MENU_Handle hObj, int Dir) {
000000  e92d5ff0          PUSH     {r4-r12,lr}
000004  4683              MOV      r11,r0
000006  4688              MOV      r8,r1
;;;964      MENU_Obj * pObj;
;;;965      int NewIndex, Index, NumItems, Cnt = 0;
000008  2600              MOVS     r6,#0
;;;966      pObj = (MENU_Obj*) GUI_ALLOC_h2p(hObj);
00000a  4658              MOV      r0,r11
00000c  f7fffffe          BL       GUI_ALLOC_h2p
000010  4605              MOV      r5,r0
;;;967      Index = pObj->Sel;
000012  6eec              LDR      r4,[r5,#0x6c]
;;;968      NewIndex = -1;
000014  f04f39ff          MOV      r9,#0xffffffff
;;;969      NumItems = pObj->ItemArray.NumItems;
000018  f8b5a058          LDRH     r10,[r5,#0x58]
;;;970      do {
00001c  bf00              NOP      
                  |L33.30|
;;;971        MENU_ITEM * pItem;
;;;972        Index += Dir;
00001e  4444              ADD      r4,r4,r8
;;;973        if (Index >= NumItems) {
000020  4554              CMP      r4,r10
000022  db02              BLT      |L33.42|
;;;974          Index = 0;
000024  2400              MOVS     r4,#0
;;;975          Cnt++;
000026  1c76              ADDS     r6,r6,#1
000028  e004              B        |L33.52|
                  |L33.42|
;;;976        } else if (Index < 0) {
00002a  2c00              CMP      r4,#0
00002c  da02              BGE      |L33.52|
;;;977          Index = NumItems - 1;
00002e  f1aa0401          SUB      r4,r10,#1
;;;978          Cnt++;
000032  1c76              ADDS     r6,r6,#1
                  |L33.52|
;;;979        }
;;;980        pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
000034  4621              MOV      r1,r4
000036  f1050058          ADD      r0,r5,#0x58
00003a  f7fffffe          BL       GUI_ARRAY_GetpItem
00003e  4607              MOV      r7,r0
;;;981        if (!(pItem->Flags & MENU_IF_SEPARATOR)) {
000040  7938              LDRB     r0,[r7,#4]
000042  f0100f02          TST      r0,#2
000046  d100              BNE      |L33.74|
;;;982          NewIndex = Index;
000048  46a1              MOV      r9,r4
                  |L33.74|
;;;983        }
;;;984      } while ((NewIndex < 0) && (Cnt < 2));
00004a  f1b90f00          CMP      r9,#0
00004e  da01              BGE      |L33.84|
000050  2e02              CMP      r6,#2
000052  dbe4              BLT      |L33.30|
                  |L33.84|
;;;985      if (NewIndex >= 0) {
000054  f1b90f00          CMP      r9,#0
000058  db04              BLT      |L33.100|
;;;986        _SetSelection(hObj, pObj, Index);
00005a  4622              MOV      r2,r4
00005c  4629              MOV      r1,r5
00005e  4658              MOV      r0,r11
000060  f7fffffe          BL       _SetSelection
                  |L33.100|
;;;987      }
;;;988    }
000064  e8bd9ff0          POP      {r4-r12,pc}
;;;989    
                          ENDP


                          AREA ||i._OnKey||, CODE, READONLY, ALIGN=1

                  _OnKey PROC
;;;1012   */
;;;1013   static int _OnKey(MENU_Handle hObj, MENU_Obj * pObj, int Key) {
000000  e92d4ff0          PUSH     {r4-r11,lr}
000004  b085              SUB      sp,sp,#0x14
000006  4607              MOV      r7,r0
000008  460d              MOV      r5,r1
00000a  4614              MOV      r4,r2
;;;1014     int KeyOpen, KeyBack, KeyNext, KeyPrev, Index, SubSel = 0;
00000c  2000              MOVS     r0,#0
00000e  9003              STR      r0,[sp,#0xc]
;;;1015     MENU_ITEM * pItem;
;;;1016     MENU_Handle hObjTopLevel;
;;;1017     MENU_Obj * pObjTopLevel;
;;;1018     Index = pObj->Sel;
000010  6ee8              LDR      r0,[r5,#0x6c]
000012  9004              STR      r0,[sp,#0x10]
;;;1019     _GetTopLevelMenu(hObj, pObj, &hObjTopLevel, &pObjTopLevel, &SubSel);
000014  a803              ADD      r0,sp,#0xc
000016  ab01              ADD      r3,sp,#4
000018  aa02              ADD      r2,sp,#8
00001a  4629              MOV      r1,r5
00001c  9000              STR      r0,[sp,#0]
00001e  4638              MOV      r0,r7
000020  f7fffffe          BL       _GetTopLevelMenu
;;;1020     if (Index < 0) {
000024  9804              LDR      r0,[sp,#0x10]
000026  2800              CMP      r0,#0
000028  da0e              BGE      |L34.72|
;;;1021       if (Key != GUI_KEY_ESCAPE) {
00002a  2c1b              CMP      r4,#0x1b
00002c  d008              BEQ      |L34.64|
;;;1022         _SetSelection(hObj, pObj, 0);
00002e  2200              MOVS     r2,#0
000030  4629              MOV      r1,r5
000032  4638              MOV      r0,r7
000034  f7fffffe          BL       _SetSelection
;;;1023         _SetCapture(hObj, pObj);
000038  4629              MOV      r1,r5
00003a  4638              MOV      r0,r7
00003c  f7fffffe          BL       _SetCapture
                  |L34.64|
;;;1024       }
;;;1025       return 0;
000040  2000              MOVS     r0,#0
                  |L34.66|
;;;1026     }
;;;1027     if (pObj->Flags & MENU_CF_VERTICAL) {
;;;1028       KeyOpen = GUI_KEY_RIGHT;
;;;1029       KeyBack = GUI_KEY_LEFT;
;;;1030       KeyNext = GUI_KEY_DOWN;
;;;1031       KeyPrev = GUI_KEY_UP;
;;;1032     } else {
;;;1033       KeyOpen = GUI_KEY_DOWN;
;;;1034       KeyBack = 0;
;;;1035       KeyNext = GUI_KEY_RIGHT;
;;;1036       KeyPrev = GUI_KEY_LEFT;
;;;1037     }
;;;1038     pItem = (MENU_ITEM *)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
;;;1039     if (pItem->hSubmenu && ((Key == KeyOpen) || (Key == GUI_KEY_ENTER))) {
;;;1040       /*
;;;1041        *  If the current menu item is a submenu and <ENTER> or KeyOpen has been pressed, open the submenu
;;;1042        */
;;;1043       _OpenMenu(hObj, pObj, Index, 0);
;;;1044     } else if (!pItem->hSubmenu && (Key == GUI_KEY_ENTER)) {
;;;1045       /*
;;;1046        *  If the current menu item is not a submenu and <ENTER> has been pressed,
;;;1047        *  set the focus to the top level menu, close the submenus and send an MENU_ON_ITEMSELECT message to the owner
;;;1048        */
;;;1049       WM_SetFocus(hObjTopLevel);
;;;1050       _ActivateItem(hObj, pObj, Index);
;;;1051     } else if (((hObjTopLevel != hObj) && !(pObjTopLevel->Flags & MENU_CF_VERTICAL) && (Key == KeyOpen) && (!pItem->hSubmenu)) ||
;;;1052                ((hObjTopLevel != hObj) && !(pObjTopLevel->Flags & MENU_CF_VERTICAL) && (Key == KeyBack) && (hObjTopLevel == pObj->hOwner))) {
;;;1053       /*
;;;1054        *  If the current menu is not the top level menu and the top level menu is horizontal
;;;1055        *  and <GUI_KEY_RIGHT> or <GUI_KEY_LEFT> has been pressed close the current submenus,
;;;1056        *  move the selection of the top level menu to next/previous item and open it
;;;1057        */
;;;1058       pObj->Flags &= ~MENU_SF_ACTIVE;
;;;1059       /* Set focus to top level menu */
;;;1060       WM_SetFocus(hObjTopLevel);
;;;1061       /* Move selection of top level menu */
;;;1062       if (Key == KeyOpen) {
;;;1063         _MoveSel(hObjTopLevel, +1);
;;;1064       } else {
;;;1065         _MoveSel(hObjTopLevel, -1);
;;;1066       }
;;;1067       /* Open top level menu */
;;;1068       _OpenMenu(hObjTopLevel, pObjTopLevel, pObjTopLevel->Sel, (Key == KeyBack) ? SubSel : 0);
;;;1069     } else if ((hObjTopLevel != hObj) && 
;;;1070                ((Key == GUI_KEY_ESCAPE) || ((Key == KeyBack) && ((!(pObjTopLevel->Flags & MENU_CF_VERTICAL)) && (!pItem->hSubmenu) && (hObjTopLevel != pObj->hOwner)) || (pObjTopLevel->Flags & MENU_CF_VERTICAL)))) {
;;;1071       /*
;;;1072        *  If the current menu is not the top level menu and the top level menu is vertical and <GUI_KEY_LEFT> has been pressed
;;;1073        *  or the top level menu is vertical or horizontal and <GUI_KEY_ESCAPE> has been pressed,
;;;1074        *  close the current submenu
;;;1075        */
;;;1076       WM_SetFocus(pObj->hOwner);
;;;1077     } else if ((hObjTopLevel == hObj) && (Key == GUI_KEY_ESCAPE)) {
;;;1078       /*
;;;1079        *  If the current menu is the top level menu and <GUI_KEY_ESCAPE> has been pressed,
;;;1080        *  unselect the menu and release capture
;;;1081        */
;;;1082       _SetSelection(hObj, pObj, -1);
;;;1083       _ReleaseCapture(hObj, pObj);
;;;1084     } else if (Key == KeyNext) {
;;;1085       /*
;;;1086        *  If KeyNext has been pressed move the selection to the next menu item
;;;1087        */
;;;1088       _CloseSubmenu(hObj, pObj);
;;;1089       _MoveSel(hObj, +1);
;;;1090     } else if (Key == KeyPrev) {
;;;1091       /*
;;;1092        *  If KeyPrev has been pressed move the selection to the previous menu item
;;;1093        */
;;;1094       _CloseSubmenu(hObj, pObj);
;;;1095       _MoveSel(hObj, -1);
;;;1096     } else {
;;;1097       return 1;
;;;1098     }
;;;1099     return 0;
;;;1100   }
000042  b005              ADD      sp,sp,#0x14
000044  e8bd8ff0          POP      {r4-r11,pc}
                  |L34.72|
000048  f895005e          LDRB     r0,[r5,#0x5e]         ;1027
00004c  f0100f01          TST      r0,#1                 ;1027
000050  d008              BEQ      |L34.100|
000052  f04f0812          MOV      r8,#0x12              ;1028
000056  f04f0910          MOV      r9,#0x10              ;1029
00005a  f04f0a13          MOV      r10,#0x13             ;1030
00005e  f04f0b11          MOV      r11,#0x11             ;1031
000062  e007              B        |L34.116|
                  |L34.100|
000064  f04f0813          MOV      r8,#0x13              ;1033
000068  f04f0900          MOV      r9,#0                 ;1034
00006c  f04f0a12          MOV      r10,#0x12             ;1035
000070  f04f0b10          MOV      r11,#0x10             ;1036
                  |L34.116|
000074  f1050058          ADD      r0,r5,#0x58           ;1038
000078  9904              LDR      r1,[sp,#0x10]         ;1038
00007a  f7fffffe          BL       GUI_ARRAY_GetpItem
00007e  4606              MOV      r6,r0                 ;1038
000080  8830              LDRH     r0,[r6,#0]            ;1039
000082  b150              CBZ      r0,|L34.154|
000084  4544              CMP      r4,r8                 ;1039
000086  d001              BEQ      |L34.140|
000088  2c0d              CMP      r4,#0xd               ;1039
00008a  d106              BNE      |L34.154|
                  |L34.140|
00008c  2300              MOVS     r3,#0                 ;1043
00008e  4629              MOV      r1,r5                 ;1043
000090  4638              MOV      r0,r7                 ;1043
000092  9a04              LDR      r2,[sp,#0x10]         ;1043
000094  f7fffffe          BL       _OpenMenu
000098  e09e              B        |L34.472|
                  |L34.154|
00009a  8830              LDRH     r0,[r6,#0]            ;1044
00009c  b958              CBNZ     r0,|L34.182|
00009e  2c0d              CMP      r4,#0xd               ;1044
0000a0  d109              BNE      |L34.182|
0000a2  f9bd0008          LDRSH    r0,[sp,#8]            ;1049
0000a6  f7fffffe          BL       WM_SetFocus
0000aa  4629              MOV      r1,r5                 ;1050
0000ac  4638              MOV      r0,r7                 ;1050
0000ae  9a04              LDR      r2,[sp,#0x10]         ;1050
0000b0  f7fffffe          BL       _ActivateItem
0000b4  e090              B        |L34.472|
                  |L34.182|
0000b6  f9bd0008          LDRSH    r0,[sp,#8]            ;1051
0000ba  42b8              CMP      r0,r7                 ;1051
0000bc  d009              BEQ      |L34.210|
0000be  9801              LDR      r0,[sp,#4]            ;1051
0000c0  f890005e          LDRB     r0,[r0,#0x5e]         ;1051
0000c4  f0100f01          TST      r0,#1                 ;1051
0000c8  d103              BNE      |L34.210|
0000ca  4544              CMP      r4,r8                 ;1051
0000cc  d101              BNE      |L34.210|
0000ce  8830              LDRH     r0,[r6,#0]            ;1051
0000d0  b188              CBZ      r0,|L34.246|
                  |L34.210|
0000d2  f9bd0008          LDRSH    r0,[sp,#8]            ;1052
0000d6  42b8              CMP      r0,r7                 ;1052
0000d8  d033              BEQ      |L34.322|
0000da  9801              LDR      r0,[sp,#4]            ;1052
0000dc  f890005e          LDRB     r0,[r0,#0x5e]         ;1052
0000e0  f0100f01          TST      r0,#1                 ;1052
0000e4  d12d              BNE      |L34.322|
0000e6  454c              CMP      r4,r9                 ;1052
0000e8  d12b              BNE      |L34.322|
0000ea  f9b5005c          LDRSH    r0,[r5,#0x5c]         ;1052
0000ee  f9bd1008          LDRSH    r1,[sp,#8]            ;1052
0000f2  4288              CMP      r0,r1                 ;1052
0000f4  d125              BNE      |L34.322|
                  |L34.246|
0000f6  f8b5005e          LDRH     r0,[r5,#0x5e]         ;1058
0000fa  f0200040          BIC      r0,r0,#0x40           ;1058
0000fe  f8a5005e          STRH     r0,[r5,#0x5e]         ;1058
000102  f9bd0008          LDRSH    r0,[sp,#8]            ;1060
000106  f7fffffe          BL       WM_SetFocus
00010a  4544              CMP      r4,r8                 ;1062
00010c  d105              BNE      |L34.282|
00010e  2101              MOVS     r1,#1                 ;1063
000110  f9bd0008          LDRSH    r0,[sp,#8]            ;1063
000114  f7fffffe          BL       _MoveSel
000118  e005              B        |L34.294|
                  |L34.282|
00011a  f04f31ff          MOV      r1,#0xffffffff        ;1065
00011e  f9bd0008          LDRSH    r0,[sp,#8]            ;1065
000122  f7fffffe          BL       _MoveSel
                  |L34.294|
000126  454c              CMP      r4,r9                 ;1068
000128  d101              BNE      |L34.302|
00012a  9803              LDR      r0,[sp,#0xc]          ;1068
00012c  e000              B        |L34.304|
                  |L34.302|
00012e  2000              MOVS     r0,#0                 ;1068
                  |L34.304|
000130  4603              MOV      r3,r0                 ;1068
000132  9801              LDR      r0,[sp,#4]            ;1068
000134  4601              MOV      r1,r0                 ;1068
000136  6ec2              LDR      r2,[r0,#0x6c]         ;1068
000138  f9bd0008          LDRSH    r0,[sp,#8]            ;1068
00013c  f7fffffe          BL       _OpenMenu
000140  e04a              B        |L34.472|
                  |L34.322|
000142  f9bd0008          LDRSH    r0,[sp,#8]            ;1069
000146  42b8              CMP      r0,r7                 ;1069
000148  d01c              BEQ      |L34.388|
00014a  2c1b              CMP      r4,#0x1b              ;1070
00014c  d015              BEQ      |L34.378|
00014e  454c              CMP      r4,r9                 ;1070
000150  d10d              BNE      |L34.366|
000152  9801              LDR      r0,[sp,#4]            ;1070
000154  f890005e          LDRB     r0,[r0,#0x5e]         ;1070
000158  f0100f01          TST      r0,#1                 ;1070
00015c  d107              BNE      |L34.366|
00015e  8830              LDRH     r0,[r6,#0]            ;1070
000160  b928              CBNZ     r0,|L34.366|
000162  f9b5005c          LDRSH    r0,[r5,#0x5c]         ;1070
000166  f9bd1008          LDRSH    r1,[sp,#8]            ;1070
00016a  4288              CMP      r0,r1                 ;1070
00016c  d105              BNE      |L34.378|
                  |L34.366|
00016e  9801              LDR      r0,[sp,#4]            ;1070
000170  f890005e          LDRB     r0,[r0,#0x5e]         ;1070
000174  f0100f01          TST      r0,#1                 ;1070
000178  d004              BEQ      |L34.388|
                  |L34.378|
00017a  f9b5005c          LDRSH    r0,[r5,#0x5c]         ;1076
00017e  f7fffffe          BL       WM_SetFocus
000182  e029              B        |L34.472|
                  |L34.388|
000184  f9bd0008          LDRSH    r0,[sp,#8]            ;1077
000188  42b8              CMP      r0,r7                 ;1077
00018a  d10c              BNE      |L34.422|
00018c  2c1b              CMP      r4,#0x1b              ;1077
00018e  d10a              BNE      |L34.422|
000190  f04f32ff          MOV      r2,#0xffffffff        ;1082
000194  4629              MOV      r1,r5                 ;1082
000196  4638              MOV      r0,r7                 ;1082
000198  f7fffffe          BL       _SetSelection
00019c  4629              MOV      r1,r5                 ;1083
00019e  4638              MOV      r0,r7                 ;1083
0001a0  f7fffffe          BL       _ReleaseCapture
0001a4  e018              B        |L34.472|
                  |L34.422|
0001a6  4554              CMP      r4,r10                ;1084
0001a8  d108              BNE      |L34.444|
0001aa  4629              MOV      r1,r5                 ;1088
0001ac  4638              MOV      r0,r7                 ;1088
0001ae  f7fffffe          BL       _CloseSubmenu
0001b2  2101              MOVS     r1,#1                 ;1089
0001b4  4638              MOV      r0,r7                 ;1089
0001b6  f7fffffe          BL       _MoveSel
0001ba  e00d              B        |L34.472|
                  |L34.444|
0001bc  455c              CMP      r4,r11                ;1090
0001be  d109              BNE      |L34.468|
0001c0  4629              MOV      r1,r5                 ;1094
0001c2  4638              MOV      r0,r7                 ;1094
0001c4  f7fffffe          BL       _CloseSubmenu
0001c8  f04f31ff          MOV      r1,#0xffffffff        ;1095
0001cc  4638              MOV      r0,r7                 ;1095
0001ce  f7fffffe          BL       _MoveSel
0001d2  e001              B        |L34.472|
                  |L34.468|
0001d4  2001              MOVS     r0,#1                 ;1097
0001d6  e734              B        |L34.66|
                  |L34.472|
0001d8  2000              MOVS     r0,#0                 ;1099
0001da  e732              B        |L34.66|
;;;1101   
                          ENDP


                          AREA ||i._OnMenu||, CODE, READONLY, ALIGN=1

                  _OnMenu PROC
;;;786    */
;;;787    static void _OnMenu(MENU_Handle hObj, MENU_Obj* pObj, WM_MESSAGE* pMsg) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  4606              MOV      r6,r0
000006  460c              MOV      r4,r1
000008  4615              MOV      r5,r2
;;;788      const MENU_MSG_DATA* pData = (const MENU_MSG_DATA*)pMsg->Data.p;
00000a  68af              LDR      r7,[r5,#8]
;;;789      if (pData) {
00000c  2f00              CMP      r7,#0
00000e  d046              BEQ      |L35.158|
;;;790        switch (pData->MsgType) {
000010  8838              LDRH     r0,[r7,#0]
000012  2806              CMP      r0,#6
000014  d242              BCS      |L35.156|
000016  e8dff000          TBB      [pc,r0]
00001a  0310              DCB      0x03,0x10
00001c  1124393e          DCB      0x11,0x24,0x39,0x3e
;;;791        case MENU_ON_ITEMSELECT:
;;;792          _DeactivateMenu(hObj, pObj);
000020  4621              MOV      r1,r4
000022  4630              MOV      r0,r6
000024  f7fffffe          BL       _DeactivateMenu
;;;793          _DeselectItem(hObj, pObj);
000028  4621              MOV      r1,r4
00002a  4630              MOV      r0,r6
00002c  f7fffffe          BL       _DeselectItem
;;;794          _ClosePopup(hObj, pObj);
000030  4621              MOV      r1,r4
000032  4630              MOV      r0,r6
000034  f7fffffe          BL       _ClosePopup
;;;795          /* No break here. We need to forward message to owner. */
;;;796        case MENU_ON_INITMENU:
000038  bf00              NOP      
;;;797        case MENU_ON_INITSUBMENU:
00003a  bf00              NOP      
;;;798          /* Forward message to owner. */
;;;799          {
;;;800            WM_HWIN hOwner;
;;;801            hOwner = pObj->hOwner ? pObj->hOwner : WM_GetParent(hObj);
00003c  f8b4005c          LDRH     r0,[r4,#0x5c]
000040  b110              CBZ      r0,|L35.72|
000042  f9b4005c          LDRSH    r0,[r4,#0x5c]
000046  e002              B        |L35.78|
                  |L35.72|
000048  4630              MOV      r0,r6
00004a  f7fffffe          BL       WM_GetParent
                  |L35.78|
00004e  4680              MOV      r8,r0
;;;802            if (hOwner) {
000050  f1b80f00          CMP      r8,#0
000054  d004              BEQ      |L35.96|
;;;803              pMsg->hWinSrc = hObj;
000056  80ee              STRH     r6,[r5,#6]
;;;804              WM__SendMessage(hOwner, pMsg);
000058  4629              MOV      r1,r5
00005a  4640              MOV      r0,r8
00005c  f7fffffe          BL       WM__SendMessage
                  |L35.96|
;;;805            }
;;;806          }
;;;807          break;
000060  e01c              B        |L35.156|
;;;808        case MENU_ON_OPEN:
;;;809          pObj->Sel = -1;
000062  f04f30ff          MOV      r0,#0xffffffff
000066  66e0              STR      r0,[r4,#0x6c]
;;;810          pObj->IsSubmenuActive = 0;
000068  2000              MOVS     r0,#0
00006a  f8840060          STRB     r0,[r4,#0x60]
;;;811          pObj->Flags |= MENU_SF_ACTIVE | MENU_SF_OPEN_ON_POINTEROVER;
00006e  f8b4005e          LDRH     r0,[r4,#0x5e]
000072  f0400042          ORR      r0,r0,#0x42
000076  f8a4005e          STRH     r0,[r4,#0x5e]
;;;812          _SetCapture(hObj, pObj);
00007a  4621              MOV      r1,r4
00007c  4630              MOV      r0,r6
00007e  f7fffffe          BL       _SetCapture
;;;813          MENU__ResizeMenu(hObj, pObj);
000082  4621              MOV      r1,r4
000084  4630              MOV      r0,r6
000086  f7fffffe          BL       MENU__ResizeMenu
;;;814          break;
00008a  e007              B        |L35.156|
;;;815        case MENU_ON_CLOSE:
;;;816          _CloseSubmenu(hObj, pObj);
00008c  4621              MOV      r1,r4
00008e  4630              MOV      r0,r6
000090  f7fffffe          BL       _CloseSubmenu
;;;817          break;
000094  e002              B        |L35.156|
;;;818        case MENU_IS_MENU:
;;;819          pMsg->Data.v = 1;
000096  2001              MOVS     r0,#1
000098  60a8              STR      r0,[r5,#8]
;;;820          break;
00009a  bf00              NOP      
                  |L35.156|
00009c  bf00              NOP                            ;807
                  |L35.158|
;;;821        }
;;;822      }
;;;823    }
00009e  e8bd81f0          POP      {r4-r8,pc}
;;;824    
                          ENDP


                          AREA ||i._OnPaint||, CODE, READONLY, ALIGN=2

                  _OnPaint PROC
;;;880    */
;;;881    static void _OnPaint(MENU_Handle hObj, MENU_Obj* pObj) {
000000  e92d4ff3          PUSH     {r0,r1,r4-r11,lr}
000004  b089              SUB      sp,sp,#0x24
000006  460c              MOV      r4,r1
;;;882      GUI_RECT FillRect, TextRect;
;;;883      MENU_ITEM* pItem;
;;;884      unsigned TextWidth, NumItems, i;
;;;885      U8 BorderLeft   = pObj->Props.aBorder[MENU_BI_LEFT];
000008  f8949050          LDRB     r9,[r4,#0x50]
;;;886      U8 BorderTop    = pObj->Props.aBorder[MENU_BI_TOP];
00000c  f894a052          LDRB     r10,[r4,#0x52]
;;;887      int FontHeight  = GUI_GetYDistOfFont(pObj->Props.pFont);
000010  6d60              LDR      r0,[r4,#0x54]
000012  f7fffffe          BL       GUI_GetYDistOfFont
000016  9003              STR      r0,[sp,#0xc]
;;;888      int EffectSize  = _GetEffectSize(hObj, pObj);
000018  4621              MOV      r1,r4
00001a  9809              LDR      r0,[sp,#0x24]
00001c  f7fffffe          BL       _GetEffectSize
000020  4607              MOV      r7,r0
;;;889      NumItems = MENU__GetNumItems(pObj);
000022  4620              MOV      r0,r4
000024  f7fffffe          BL       MENU__GetNumItems
000028  9004              STR      r0,[sp,#0x10]
;;;890      WM__GetClientRectWin(&pObj->Widget.Win, &FillRect);
00002a  a907              ADD      r1,sp,#0x1c
00002c  4620              MOV      r0,r4
00002e  f7fffffe          BL       WM__GetClientRectWin
;;;891      GUI__ReduceRect(&FillRect, &FillRect, EffectSize);
000032  463a              MOV      r2,r7
000034  a907              ADD      r1,sp,#0x1c
000036  a807              ADD      r0,sp,#0x1c
000038  f7fffffe          BL       GUI__ReduceRect
;;;892      GUI_SetFont(pObj->Props.pFont);
00003c  6d60              LDR      r0,[r4,#0x54]
00003e  f7fffffe          BL       GUI_SetFont
;;;893      if (pObj->Flags & MENU_SF_VERTICAL) {
000042  f894005e          LDRB     r0,[r4,#0x5e]
000046  f0100f01          TST      r0,#1
00004a  d06a              BEQ      |L36.290|
;;;894        int ItemHeight, xSize;
;;;895        xSize = _CalcMenuSizeX(hObj, pObj);
00004c  4621              MOV      r1,r4
00004e  9809              LDR      r0,[sp,#0x24]
000050  f7fffffe          BL       _CalcMenuSizeX
000054  9002              STR      r0,[sp,#8]
;;;896        FillRect.x1 = xSize - EffectSize - 1;
000056  9802              LDR      r0,[sp,#8]
000058  1bc0              SUBS     r0,r0,r7
00005a  1e40              SUBS     r0,r0,#1
00005c  b200              SXTH     r0,r0
00005e  f8ad0020          STRH     r0,[sp,#0x20]
;;;897        TextRect.x0 = FillRect.x0 + BorderLeft;
000062  f8bd001c          LDRH     r0,[sp,#0x1c]
000066  4448              ADD      r0,r0,r9
000068  b200              SXTH     r0,r0
00006a  f8ad0014          STRH     r0,[sp,#0x14]
;;;898        for (i = 0; i < NumItems; i++) {
00006e  2600              MOVS     r6,#0
000070  e053              B        |L36.282|
                  |L36.114|
;;;899          pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, i);
000072  4631              MOV      r1,r6
000074  f1040058          ADD      r0,r4,#0x58
000078  f7fffffe          BL       GUI_ARRAY_GetpItem
00007c  4605              MOV      r5,r0
;;;900          ItemHeight = _GetItemHeight(hObj, pObj, i);
00007e  4632              MOV      r2,r6
000080  4621              MOV      r1,r4
000082  9809              LDR      r0,[sp,#0x24]
000084  f7fffffe          BL       _GetItemHeight
000088  4683              MOV      r11,r0
;;;901          _SetPaintColors(pObj, pItem, i);
00008a  4632              MOV      r2,r6
00008c  4629              MOV      r1,r5
00008e  4620              MOV      r0,r4
000090  f7fffffe          BL       _SetPaintColors
;;;902          FillRect.y1 = FillRect.y0 + ItemHeight - 1;
000094  f8bd001e          LDRH     r0,[sp,#0x1e]
000098  4458              ADD      r0,r0,r11
00009a  1e40              SUBS     r0,r0,#1
00009c  b200              SXTH     r0,r0
00009e  f8ad0022          STRH     r0,[sp,#0x22]
;;;903          if (pItem->Flags & MENU_IF_SEPARATOR) {
0000a2  7928              LDRB     r0,[r5,#4]
0000a4  f0100f02          TST      r0,#2
0000a8  d012              BEQ      |L36.208|
;;;904            GUI_ClearRectEx(&FillRect);
0000aa  a807              ADD      r0,sp,#0x1c
0000ac  f7fffffe          BL       GUI_ClearRectEx
;;;905            GUI_SetColor(0x7C7C7C);
0000b0  4869              LDR      r0,|L36.600|
0000b2  f7fffffe          BL       GUI_SetColor
;;;906            GUI_DrawHLine(FillRect.y0 + BorderTop + 1, FillRect.x0 + 2, FillRect.x1 - 2);
0000b6  f9bd3020          LDRSH    r3,[sp,#0x20]
0000ba  1e9a              SUBS     r2,r3,#2
0000bc  f9bd301c          LDRSH    r3,[sp,#0x1c]
0000c0  1c99              ADDS     r1,r3,#2
0000c2  f9bd301e          LDRSH    r3,[sp,#0x1e]
0000c6  4453              ADD      r3,r3,r10
0000c8  1c58              ADDS     r0,r3,#1
0000ca  f7fffffe          BL       GUI_DrawHLine
0000ce  e01d              B        |L36.268|
                  |L36.208|
;;;907          } else {
;;;908            TextWidth = pItem->TextWidth;
0000d0  f8d58008          LDR      r8,[r5,#8]
;;;909            TextRect.x1 = TextRect.x0 + TextWidth - 1;
0000d4  f8bd0014          LDRH     r0,[sp,#0x14]
0000d8  4440              ADD      r0,r0,r8
0000da  1e40              SUBS     r0,r0,#1
0000dc  b200              SXTH     r0,r0
0000de  f8ad0018          STRH     r0,[sp,#0x18]
;;;910            TextRect.y0 = FillRect.y0 + BorderTop;
0000e2  f8bd001e          LDRH     r0,[sp,#0x1e]
0000e6  4450              ADD      r0,r0,r10
0000e8  b200              SXTH     r0,r0
0000ea  f8ad0016          STRH     r0,[sp,#0x16]
;;;911            TextRect.y1 = TextRect.y0 + FontHeight - 1;
0000ee  f8bd1016          LDRH     r1,[sp,#0x16]
0000f2  9803              LDR      r0,[sp,#0xc]
0000f4  4408              ADD      r0,r0,r1
0000f6  1e40              SUBS     r0,r0,#1
0000f8  b200              SXTH     r0,r0
0000fa  f8ad001a          STRH     r0,[sp,#0x1a]
;;;912            WIDGET__FillStringInRect(pItem->acText, &FillRect, &TextRect, &TextRect);
0000fe  ab05              ADD      r3,sp,#0x14
000100  aa05              ADD      r2,sp,#0x14
000102  a907              ADD      r1,sp,#0x1c
000104  f105000c          ADD      r0,r5,#0xc
000108  f7fffffe          BL       WIDGET__FillStringInRect
                  |L36.268|
;;;913          }
;;;914          FillRect.y0 += ItemHeight;
00010c  f8bd001e          LDRH     r0,[sp,#0x1e]
000110  4458              ADD      r0,r0,r11
000112  b200              SXTH     r0,r0
000114  f8ad001e          STRH     r0,[sp,#0x1e]
000118  1c76              ADDS     r6,r6,#1              ;898
                  |L36.282|
00011a  9804              LDR      r0,[sp,#0x10]         ;898
00011c  4286              CMP      r6,r0                 ;898
00011e  d3a8              BCC      |L36.114|
;;;915        }
;;;916      } else {
000120  e06a              B        |L36.504|
                  |L36.290|
;;;917        int ItemWidth, ySize;
;;;918        ySize = _CalcMenuSizeY(hObj, pObj);
000122  4621              MOV      r1,r4
000124  9809              LDR      r0,[sp,#0x24]
000126  f7fffffe          BL       _CalcMenuSizeY
00012a  9002              STR      r0,[sp,#8]
;;;919        FillRect.y1 = ySize - EffectSize - 1;
00012c  9802              LDR      r0,[sp,#8]
00012e  1bc0              SUBS     r0,r0,r7
000130  1e40              SUBS     r0,r0,#1
000132  b200              SXTH     r0,r0
000134  f8ad0022          STRH     r0,[sp,#0x22]
;;;920        TextRect.y0 = FillRect.y0 + BorderTop;
000138  f8bd001e          LDRH     r0,[sp,#0x1e]
00013c  4450              ADD      r0,r0,r10
00013e  b200              SXTH     r0,r0
000140  f8ad0016          STRH     r0,[sp,#0x16]
;;;921        TextRect.y1 = TextRect.y0 + FontHeight - 1;
000144  f8bd1016          LDRH     r1,[sp,#0x16]
000148  9803              LDR      r0,[sp,#0xc]
00014a  4408              ADD      r0,r0,r1
00014c  1e40              SUBS     r0,r0,#1
00014e  b200              SXTH     r0,r0
000150  f8ad001a          STRH     r0,[sp,#0x1a]
;;;922        for (i = 0; i < NumItems; i++) {
000154  2600              MOVS     r6,#0
000156  e04b              B        |L36.496|
                  |L36.344|
;;;923          pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, i);
000158  4631              MOV      r1,r6
00015a  f1040058          ADD      r0,r4,#0x58
00015e  f7fffffe          BL       GUI_ARRAY_GetpItem
000162  4605              MOV      r5,r0
;;;924          ItemWidth = _GetItemWidth(hObj, pObj, i);
000164  4632              MOV      r2,r6
000166  4621              MOV      r1,r4
000168  9809              LDR      r0,[sp,#0x24]
00016a  f7fffffe          BL       _GetItemWidth
00016e  4683              MOV      r11,r0
;;;925          _SetPaintColors(pObj, pItem, i);
000170  4632              MOV      r2,r6
000172  4629              MOV      r1,r5
000174  4620              MOV      r0,r4
000176  f7fffffe          BL       _SetPaintColors
;;;926          FillRect.x1 = FillRect.x0 + ItemWidth - 1;
00017a  f8bd001c          LDRH     r0,[sp,#0x1c]
00017e  4458              ADD      r0,r0,r11
000180  1e40              SUBS     r0,r0,#1
000182  b200              SXTH     r0,r0
000184  f8ad0020          STRH     r0,[sp,#0x20]
;;;927          if (pItem->Flags & MENU_IF_SEPARATOR) {
000188  7928              LDRB     r0,[r5,#4]
00018a  f0100f02          TST      r0,#2
00018e  d012              BEQ      |L36.438|
;;;928            GUI_ClearRectEx(&FillRect);
000190  a807              ADD      r0,sp,#0x1c
000192  f7fffffe          BL       GUI_ClearRectEx
;;;929            GUI_SetColor(0x7C7C7C);
000196  4830              LDR      r0,|L36.600|
000198  f7fffffe          BL       GUI_SetColor
;;;930            GUI_DrawVLine(FillRect.x0 + BorderLeft + 1, FillRect.y0 + 2, FillRect.y1 - 2);
00019c  f9bd3022          LDRSH    r3,[sp,#0x22]
0001a0  1e9a              SUBS     r2,r3,#2
0001a2  f9bd301e          LDRSH    r3,[sp,#0x1e]
0001a6  1c99              ADDS     r1,r3,#2
0001a8  f9bd301c          LDRSH    r3,[sp,#0x1c]
0001ac  444b              ADD      r3,r3,r9
0001ae  1c58              ADDS     r0,r3,#1
0001b0  f7fffffe          BL       GUI_DrawVLine
0001b4  e015              B        |L36.482|
                  |L36.438|
;;;931          } else {
;;;932            TextWidth = pItem->TextWidth;
0001b6  f8d58008          LDR      r8,[r5,#8]
;;;933            TextRect.x0 = FillRect.x0 + BorderLeft;
0001ba  f8bd001c          LDRH     r0,[sp,#0x1c]
0001be  4448              ADD      r0,r0,r9
0001c0  b200              SXTH     r0,r0
0001c2  f8ad0014          STRH     r0,[sp,#0x14]
;;;934            TextRect.x1 = TextRect.x0 + TextWidth - 1;
0001c6  f8bd0014          LDRH     r0,[sp,#0x14]
0001ca  4440              ADD      r0,r0,r8
0001cc  1e40              SUBS     r0,r0,#1
0001ce  b200              SXTH     r0,r0
0001d0  f8ad0018          STRH     r0,[sp,#0x18]
;;;935            WIDGET__FillStringInRect(pItem->acText, &FillRect, &TextRect, &TextRect);
0001d4  ab05              ADD      r3,sp,#0x14
0001d6  aa05              ADD      r2,sp,#0x14
0001d8  a907              ADD      r1,sp,#0x1c
0001da  f105000c          ADD      r0,r5,#0xc
0001de  f7fffffe          BL       WIDGET__FillStringInRect
                  |L36.482|
;;;936          }
;;;937          FillRect.x0 += ItemWidth;
0001e2  f8bd001c          LDRH     r0,[sp,#0x1c]
0001e6  4458              ADD      r0,r0,r11
0001e8  b200              SXTH     r0,r0
0001ea  f8ad001c          STRH     r0,[sp,#0x1c]
0001ee  1c76              ADDS     r6,r6,#1              ;922
                  |L36.496|
0001f0  9804              LDR      r0,[sp,#0x10]         ;922
0001f2  4286              CMP      r6,r0                 ;922
0001f4  d3b0              BCC      |L36.344|
;;;938        }
;;;939      }
0001f6  bf00              NOP      
                  |L36.504|
;;;940      if (pObj->Width || pObj->Height) {
0001f8  6e60              LDR      r0,[r4,#0x64]
0001fa  b908              CBNZ     r0,|L36.512|
0001fc  6ea0              LDR      r0,[r4,#0x68]
0001fe  b300              CBZ      r0,|L36.578|
                  |L36.512|
;;;941        GUI_RECT r;
;;;942        WM__GetClientRectWin(&pObj->Widget.Win, &r);
000200  a901              ADD      r1,sp,#4
000202  4620              MOV      r0,r4
000204  f7fffffe          BL       WM__GetClientRectWin
;;;943        GUI__ReduceRect(&r, &r, EffectSize);
000208  463a              MOV      r2,r7
00020a  a901              ADD      r1,sp,#4
00020c  a801              ADD      r0,sp,#4
00020e  f7fffffe          BL       GUI__ReduceRect
;;;944        GUI_SetBkColor(pObj->Props.aBkColor[MENU_CI_ENABLED]);
000212  6be0              LDR      r0,[r4,#0x3c]
000214  f7fffffe          BL       GUI_SetBkColor
;;;945        GUI_ClearRect(FillRect.x1 + 1, EffectSize, r.x1, FillRect.y1);
000218  f9bd3022          LDRSH    r3,[sp,#0x22]
00021c  f9bd2008          LDRSH    r2,[sp,#8]
000220  f9bd1020          LDRSH    r1,[sp,#0x20]
000224  1c48              ADDS     r0,r1,#1
000226  4639              MOV      r1,r7
000228  f7fffffe          BL       GUI_ClearRect
;;;946        GUI_ClearRect(EffectSize, FillRect.y1 + 1, r.x1, r.y1);
00022c  f9bd300a          LDRSH    r3,[sp,#0xa]
000230  f9bd2008          LDRSH    r2,[sp,#8]
000234  f9bd0022          LDRSH    r0,[sp,#0x22]
000238  1c41              ADDS     r1,r0,#1
00023a  4638              MOV      r0,r7
00023c  f7fffffe          BL       GUI_ClearRect
;;;947      }
000240  bf00              NOP      
                  |L36.578|
;;;948      /* Draw 3D effect (if configured) */
;;;949      if (_HasEffect(hObj, pObj)) {
000242  4621              MOV      r1,r4
000244  9809              LDR      r0,[sp,#0x24]
000246  f7fffffe          BL       _HasEffect
00024a  b110              CBZ      r0,|L36.594|
;;;950        pObj->Widget.pEffect->pfDrawUp();
00024c  6a21              LDR      r1,[r4,#0x20]
00024e  6808              LDR      r0,[r1,#0]
000250  4780              BLX      r0
                  |L36.594|
;;;951      }
;;;952    }
000252  b00b              ADD      sp,sp,#0x2c
000254  e8bd8ff0          POP      {r4-r11,pc}
;;;953    
                          ENDP

                  |L36.600|
                          DCD      0x007c7c7c

                          AREA ||i._OnTouch||, CODE, READONLY, ALIGN=1

                  _OnTouch PROC
;;;828    */
;;;829    static char _OnTouch(MENU_Handle hObj, MENU_Obj* pObj, WM_MESSAGE* pMsg) {
000000  b5f8              PUSH     {r3-r7,lr}
000002  4606              MOV      r6,r0
000004  460f              MOV      r7,r1
000006  4615              MOV      r5,r2
;;;830      const GUI_PID_STATE* pState = (const GUI_PID_STATE*)pMsg->Data.p;
000008  68ac              LDR      r4,[r5,#8]
;;;831      if (pState) {  /* Something happened in our area (pressed or released) */
00000a  b144              CBZ      r4,|L37.30|
;;;832        return _HandlePID(hObj, pObj, pState->x, pState->y, pState->Pressed);
00000c  7a20              LDRB     r0,[r4,#8]
00000e  9000              STR      r0,[sp,#0]
000010  4639              MOV      r1,r7
000012  4630              MOV      r0,r6
000014  e9d42300          LDRD     r2,r3,[r4,#0]
000018  f7fffffe          BL       _HandlePID
                  |L37.28|
;;;833      }
;;;834      return _HandlePID(hObj, pObj, -1, -1, -1); /* Moved out */
;;;835    }
00001c  bdf8              POP      {r3-r7,pc}
                  |L37.30|
00001e  f04f30ff          MOV      r0,#0xffffffff        ;834
000022  4603              MOV      r3,r0                 ;834
000024  4602              MOV      r2,r0                 ;834
000026  4639              MOV      r1,r7                 ;834
000028  9000              STR      r0,[sp,#0]            ;834
00002a  4630              MOV      r0,r6                 ;834
00002c  f7fffffe          BL       _HandlePID
000030  e7f4              B        |L37.28|
;;;836    
                          ENDP


                          AREA ||i._OpenMenu||, CODE, READONLY, ALIGN=1

                  _OpenMenu PROC
;;;993    */
;;;994    static void _OpenMenu(MENU_Handle hObj, MENU_Obj * pObj, int Index, int SubSel) {
000000  e92d47f0          PUSH     {r4-r10,lr}
000004  4681              MOV      r9,r0
000006  460c              MOV      r4,r1
000008  4690              MOV      r8,r2
00000a  461d              MOV      r5,r3
;;;995      MENU_ITEM * pItem;
;;;996      MENU_Obj  * pSubObj;
;;;997      pItem = (MENU_ITEM *)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
00000c  4641              MOV      r1,r8
00000e  f1040058          ADD      r0,r4,#0x58
000012  f7fffffe          BL       GUI_ARRAY_GetpItem
000016  4606              MOV      r6,r0
;;;998      pObj->Flags |= MENU_SF_ACTIVE;
000018  f8b4005e          LDRH     r0,[r4,#0x5e]
00001c  f0400040          ORR      r0,r0,#0x40
000020  f8a4005e          STRH     r0,[r4,#0x5e]
;;;999      _OpenSubmenu(hObj, pObj, Index);
000024  4642              MOV      r2,r8
000026  4621              MOV      r1,r4
000028  4648              MOV      r0,r9
00002a  f7fffffe          BL       _OpenSubmenu
;;;1000     pSubObj = (MENU_Obj *) GUI_ALLOC_h2p(pItem->hSubmenu);
00002e  f9b60000          LDRSH    r0,[r6,#0]
000032  f7fffffe          BL       GUI_ALLOC_h2p
000036  4607              MOV      r7,r0
;;;1001     if (SubSel >= pSubObj->ItemArray.NumItems) {
000038  f8b70058          LDRH     r0,[r7,#0x58]
00003c  42a8              CMP      r0,r5
00003e  dc02              BGT      |L38.70|
;;;1002       SubSel = pSubObj->ItemArray.NumItems - 1;
000040  f8b70058          LDRH     r0,[r7,#0x58]
000044  1e45              SUBS     r5,r0,#1
                  |L38.70|
;;;1003     }
;;;1004     _SetSelection(pItem->hSubmenu, pSubObj, SubSel);
000046  f9b60000          LDRSH    r0,[r6,#0]
00004a  462a              MOV      r2,r5
00004c  4639              MOV      r1,r7
00004e  f7fffffe          BL       _SetSelection
;;;1005     WM_SetFocus(pItem->hSubmenu);
000052  f9b60000          LDRSH    r0,[r6,#0]
000056  f7fffffe          BL       WM_SetFocus
;;;1006     _SetSelection(hObj, pObj, Index);
00005a  4642              MOV      r2,r8
00005c  4621              MOV      r1,r4
00005e  4648              MOV      r0,r9
000060  f7fffffe          BL       _SetSelection
;;;1007   }
000064  e8bd87f0          POP      {r4-r10,pc}
;;;1008   
                          ENDP


                          AREA ||i._OpenSubmenu||, CODE, READONLY, ALIGN=1

                  _OpenSubmenu PROC
;;;477    */
;;;478    static void _OpenSubmenu(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index) {
000000  e92d4ffe          PUSH     {r1-r11,lr}
000004  4606              MOV      r6,r0
000006  460c              MOV      r4,r1
000008  4617              MOV      r7,r2
;;;479      if (pObj->Flags & MENU_SF_ACTIVE) {
00000a  f894005e          LDRB     r0,[r4,#0x5e]
00000e  f0100f40          TST      r0,#0x40
000012  d07d              BEQ      |L39.272|
;;;480        MENU_ITEM* pItem;
;;;481        char PrevActiveSubmenu;
;;;482        PrevActiveSubmenu = pObj->IsSubmenuActive;
000014  f8949060          LDRB     r9,[r4,#0x60]
;;;483        /* Close previous submenu (if needed) */
;;;484        _CloseSubmenu(hObj, pObj);
000018  4621              MOV      r1,r4
00001a  4630              MOV      r0,r6
00001c  f7fffffe          BL       _CloseSubmenu
;;;485        pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
000020  4639              MOV      r1,r7
000022  f1040058          ADD      r0,r4,#0x58
000026  f7fffffe          BL       GUI_ARRAY_GetpItem
00002a  4605              MOV      r5,r0
;;;486        if (pItem->hSubmenu) {
00002c  8828              LDRH     r0,[r5,#0]
00002e  2800              CMP      r0,#0
000030  d07e              BEQ      |L39.304|
;;;487          if ((pItem->Flags & MENU_IF_DISABLED) == 0) {
000032  7928              LDRB     r0,[r5,#4]
000034  f0100f01          TST      r0,#1
000038  d17a              BNE      |L39.304|
;;;488            int x, y, EffectSize;
;;;489            /* Calculate position of submenu */
;;;490            EffectSize = _GetEffectSize(hObj, pObj);
00003a  4621              MOV      r1,r4
00003c  4630              MOV      r0,r6
00003e  f7fffffe          BL       _GetEffectSize
000042  4680              MOV      r8,r0
;;;491            _GetItemPos(hObj, pObj, Index, &x, &y);
000044  a801              ADD      r0,sp,#4
000046  ab02              ADD      r3,sp,#8
000048  463a              MOV      r2,r7
00004a  4621              MOV      r1,r4
00004c  9000              STR      r0,[sp,#0]
00004e  4630              MOV      r0,r6
000050  f7fffffe          BL       _GetItemPos
;;;492            if (pObj->Flags & MENU_SF_VERTICAL) {
000054  f894005e          LDRB     r0,[r4,#0x5e]
000058  f0100f01          TST      r0,#1
00005c  d012              BEQ      |L39.132|
;;;493              x += _CalcMenuSizeX(hObj, pObj) - (_GetEffectSize(hObj, pObj) << 1);
00005e  4621              MOV      r1,r4
000060  4630              MOV      r0,r6
000062  f7fffffe          BL       _CalcMenuSizeX
000066  4682              MOV      r10,r0
000068  4621              MOV      r1,r4
00006a  4630              MOV      r0,r6
00006c  f7fffffe          BL       _GetEffectSize
000070  ebaa0040          SUB      r0,r10,r0,LSL #1
000074  9902              LDR      r1,[sp,#8]
000076  4408              ADD      r0,r0,r1
000078  9002              STR      r0,[sp,#8]
;;;494              y -= EffectSize;
00007a  9801              LDR      r0,[sp,#4]
00007c  eba00008          SUB      r0,r0,r8
000080  9001              STR      r0,[sp,#4]
000082  e011              B        |L39.168|
                  |L39.132|
;;;495            } else {
;;;496              y += _CalcMenuSizeY(hObj, pObj) - (_GetEffectSize(hObj, pObj) << 1);
000084  4621              MOV      r1,r4
000086  4630              MOV      r0,r6
000088  f7fffffe          BL       _CalcMenuSizeY
00008c  4682              MOV      r10,r0
00008e  4621              MOV      r1,r4
000090  4630              MOV      r0,r6
000092  f7fffffe          BL       _GetEffectSize
000096  ebaa0040          SUB      r0,r10,r0,LSL #1
00009a  9901              LDR      r1,[sp,#4]
00009c  4408              ADD      r0,r0,r1
00009e  9001              STR      r0,[sp,#4]
;;;497              x -= EffectSize;
0000a0  9802              LDR      r0,[sp,#8]
0000a2  eba00008          SUB      r0,r0,r8
0000a6  9002              STR      r0,[sp,#8]
                  |L39.168|
;;;498            }
;;;499            x += WM_GetWindowOrgX(hObj);
0000a8  4630              MOV      r0,r6
0000aa  f7fffffe          BL       WM_GetWindowOrgX
0000ae  9902              LDR      r1,[sp,#8]
0000b0  4408              ADD      r0,r0,r1
0000b2  9002              STR      r0,[sp,#8]
;;;500            y += WM_GetWindowOrgY(hObj);
0000b4  4630              MOV      r0,r6
0000b6  f7fffffe          BL       WM_GetWindowOrgY
0000ba  9901              LDR      r1,[sp,#4]
0000bc  4408              ADD      r0,r0,r1
0000be  9001              STR      r0,[sp,#4]
;;;501            /*
;;;502             * Notify owner window when for the first time open a menu (when no
;;;503             * other submenu was open), so it can initialize the menu items.
;;;504             */
;;;505            if (PrevActiveSubmenu == 0) {
0000c0  f1b90f00          CMP      r9,#0
0000c4  d10b              BNE      |L39.222|
;;;506              if (_IsTopLevelMenu(hObj, pObj)) {
0000c6  4621              MOV      r1,r4
0000c8  4630              MOV      r0,r6
0000ca  f7fffffe          BL       _IsTopLevelMenu
0000ce  b130              CBZ      r0,|L39.222|
;;;507                MENU__SendMenuMessage(hObj, pObj->hOwner, MENU_ON_INITMENU, 0);
0000d0  f9b4105c          LDRSH    r1,[r4,#0x5c]
0000d4  2300              MOVS     r3,#0
0000d6  2201              MOVS     r2,#1
0000d8  4630              MOV      r0,r6
0000da  f7fffffe          BL       MENU__SendMenuMessage
                  |L39.222|
;;;508              }
;;;509            }
;;;510            /* Notify owner window when a submenu opens, so it can initialize the menu items. */
;;;511            MENU__SendMenuMessage(hObj, pObj->hOwner, MENU_ON_INITSUBMENU, pItem->Id);
0000de  886b              LDRH     r3,[r5,#2]
0000e0  f9b4105c          LDRSH    r1,[r4,#0x5c]
0000e4  2202              MOVS     r2,#2
0000e6  4630              MOV      r0,r6
0000e8  f7fffffe          BL       MENU__SendMenuMessage
;;;512            /* Set active menu as owner of submenu. */
;;;513            MENU_SetOwner(pItem->hSubmenu, hObj);
0000ec  f9b50000          LDRSH    r0,[r5,#0]
0000f0  4631              MOV      r1,r6
0000f2  f7fffffe          BL       MENU_SetOwner
;;;514            /* Attach submenu and inform it about its activation. */
;;;515            WM_AttachWindowAt(pItem->hSubmenu, WM_HBKWIN, x, y);
0000f6  f7fffffe          BL       WM_GetDesktopWindow
0000fa  4682              MOV      r10,r0
0000fc  f9b50000          LDRSH    r0,[r5,#0]
000100  4651              MOV      r1,r10
000102  e9dd3201          LDRD     r3,r2,[sp,#4]
000106  f7fffffe          BL       WM_AttachWindowAt
;;;516            MENU__SendMenuMessage(hObj, pItem->hSubmenu, MENU_ON_OPEN, 0);
00010a  f9b51000          LDRSH    r1,[r5,#0]
00010e  e001              B        |L39.276|
                  |L39.272|
000110  e00f              B        |L39.306|
000112  e00d              B        |L39.304|
                  |L39.276|
000114  2300              MOVS     r3,#0
000116  2203              MOVS     r2,#3
000118  4630              MOV      r0,r6
00011a  f7fffffe          BL       MENU__SendMenuMessage
;;;517            pObj->IsSubmenuActive = 1;
00011e  2001              MOVS     r0,#1
000120  f8840060          STRB     r0,[r4,#0x60]
;;;518            /* Invalidate menu item. This is needed because the appearance may have changed. */
;;;519            MENU__InvalidateItem(hObj, pObj, Index);
000124  463a              MOV      r2,r7
000126  4621              MOV      r1,r4
000128  4630              MOV      r0,r6
00012a  f7fffffe          BL       MENU__InvalidateItem
;;;520          }
00012e  bf00              NOP      
                  |L39.304|
;;;521        }
;;;522      }
000130  bf00              NOP      
                  |L39.306|
;;;523    }
000132  e8bd8ffe          POP      {r1-r11,pc}
;;;524    
                          ENDP


                          AREA ||i._ReleaseCapture||, CODE, READONLY, ALIGN=1

                  _ReleaseCapture PROC
;;;441    */
;;;442    static void _ReleaseCapture(MENU_Handle hObj, const MENU_Obj* pObj) {
000000  b570              PUSH     {r4-r6,lr}
000002  4605              MOV      r5,r0
000004  460c              MOV      r4,r1
;;;443      if (WM_HasCaptured(hObj)) {
000006  4628              MOV      r0,r5
000008  f7fffffe          BL       WM_HasCaptured
00000c  b158              CBZ      r0,|L40.38|
;;;444        if (_IsTopLevelMenu(hObj, pObj) && !(pObj->Flags & MENU_SF_POPUP)) {
00000e  4621              MOV      r1,r4
000010  4628              MOV      r0,r5
000012  f7fffffe          BL       _IsTopLevelMenu
000016  b130              CBZ      r0,|L40.38|
000018  f894005e          LDRB     r0,[r4,#0x5e]
00001c  f0100f80          TST      r0,#0x80
000020  d101              BNE      |L40.38|
;;;445          WM_ReleaseCapture();
000022  f7fffffe          BL       WM_ReleaseCapture
                  |L40.38|
;;;446        }
;;;447      }
;;;448    }
000026  bd70              POP      {r4-r6,pc}
;;;449    
                          ENDP


                          AREA ||i._SelectItem||, CODE, READONLY, ALIGN=1

                  _SelectItem PROC
;;;552    */
;;;553    static void _SelectItem(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index) {
000000  b570              PUSH     {r4-r6,lr}
000002  4606              MOV      r6,r0
000004  460c              MOV      r4,r1
000006  4615              MOV      r5,r2
;;;554      if (pObj->Sel != (int)Index) {
000008  6ee0              LDR      r0,[r4,#0x6c]
00000a  42a8              CMP      r0,r5
00000c  d00d              BEQ      |L41.42|
;;;555        _SetCapture(hObj, pObj);
00000e  4621              MOV      r1,r4
000010  4630              MOV      r0,r6
000012  f7fffffe          BL       _SetCapture
;;;556        _OpenSubmenu(hObj, pObj, Index);
000016  462a              MOV      r2,r5
000018  4621              MOV      r1,r4
00001a  4630              MOV      r0,r6
00001c  f7fffffe          BL       _OpenSubmenu
;;;557        _SetSelection(hObj, pObj, Index);
000020  462a              MOV      r2,r5
000022  4621              MOV      r1,r4
000024  4630              MOV      r0,r6
000026  f7fffffe          BL       _SetSelection
                  |L41.42|
;;;558      }
;;;559    }
00002a  bd70              POP      {r4-r6,pc}
;;;560    
                          ENDP


                          AREA ||i._SetCapture||, CODE, READONLY, ALIGN=1

                  _SetCapture PROC
;;;429    */
;;;430    static void _SetCapture(MENU_Handle hObj, const MENU_Obj* pObj) {
000000  b570              PUSH     {r4-r6,lr}
000002  4605              MOV      r5,r0
000004  460c              MOV      r4,r1
;;;431      if (pObj->IsSubmenuActive == 0) {
000006  f8940060          LDRB     r0,[r4,#0x60]
00000a  b938              CBNZ     r0,|L42.28|
;;;432        if (WM_HasCaptured(hObj) == 0) {
00000c  4628              MOV      r0,r5
00000e  f7fffffe          BL       WM_HasCaptured
000012  b918              CBNZ     r0,|L42.28|
;;;433          WM_SetCapture(hObj, 0);
000014  2100              MOVS     r1,#0
000016  4628              MOV      r0,r5
000018  f7fffffe          BL       WM_SetCapture
                  |L42.28|
;;;434        }
;;;435      }
;;;436    }
00001c  bd70              POP      {r4-r6,pc}
;;;437    
                          ENDP


                          AREA ||i._SetPaintColors||, CODE, READONLY, ALIGN=1

                  _SetPaintColors PROC
;;;854    */
;;;855    static void _SetPaintColors(const MENU_Obj* pObj, const MENU_ITEM* pItem, int ItemIndex) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  4604              MOV      r4,r0
000006  460e              MOV      r6,r1
000008  4617              MOV      r7,r2
;;;856      char Selected;
;;;857      unsigned ColorIndex;
;;;858      Selected = (ItemIndex == pObj->Sel) ? 1 : 0;
00000a  6ee0              LDR      r0,[r4,#0x6c]
00000c  42b8              CMP      r0,r7
00000e  d101              BNE      |L43.20|
000010  2001              MOVS     r0,#1
000012  e000              B        |L43.22|
                  |L43.20|
000014  2000              MOVS     r0,#0
                  |L43.22|
000016  4680              MOV      r8,r0
;;;859      if (pObj->IsSubmenuActive && Selected) {
000018  f8940060          LDRB     r0,[r4,#0x60]
00001c  b120              CBZ      r0,|L43.40|
00001e  f1b80f00          CMP      r8,#0
000022  d001              BEQ      |L43.40|
;;;860        ColorIndex = MENU_CI_ACTIVE_SUBMENU;
000024  2504              MOVS     r5,#4
000026  e018              B        |L43.90|
                  |L43.40|
;;;861      } else if (pItem->Flags & MENU_IF_SEPARATOR) {
000028  7930              LDRB     r0,[r6,#4]
00002a  f0100f02          TST      r0,#2
00002e  d001              BEQ      |L43.52|
;;;862        ColorIndex = MENU_CI_ENABLED;
000030  2500              MOVS     r5,#0
000032  e012              B        |L43.90|
                  |L43.52|
;;;863      } else {
;;;864        ColorIndex = (Selected) ? MENU_CI_SELECTED : MENU_CI_ENABLED;
000034  f1b80f00          CMP      r8,#0
000038  d001              BEQ      |L43.62|
00003a  2001              MOVS     r0,#1
00003c  e000              B        |L43.64|
                  |L43.62|
00003e  2000              MOVS     r0,#0
                  |L43.64|
000040  4605              MOV      r5,r0
;;;865        if (pItem->Flags & MENU_IF_DISABLED) {
000042  7930              LDRB     r0,[r6,#4]
000044  f0100f01          TST      r0,#1
000048  d007              BEQ      |L43.90|
;;;866          if (pObj->Flags & MENU_CF_HIDE_DISABLED_SEL) {
00004a  f894005e          LDRB     r0,[r4,#0x5e]
00004e  f0100f08          TST      r0,#8
000052  d001              BEQ      |L43.88|
;;;867            ColorIndex = MENU_CI_DISABLED;
000054  2502              MOVS     r5,#2
000056  e000              B        |L43.90|
                  |L43.88|
;;;868          } else {
;;;869            ColorIndex += MENU_CI_DISABLED;
000058  1cad              ADDS     r5,r5,#2
                  |L43.90|
;;;870          }
;;;871        }
;;;872      }
;;;873      GUI_SetBkColor(pObj->Props.aBkColor[ColorIndex]);
00005a  f104013c          ADD      r1,r4,#0x3c
00005e  f8510025          LDR      r0,[r1,r5,LSL #2]
000062  f7fffffe          BL       GUI_SetBkColor
;;;874      GUI_SetColor(pObj->Props.aTextColor[ColorIndex]);
000066  f1040128          ADD      r1,r4,#0x28
00006a  f8510025          LDR      r0,[r1,r5,LSL #2]
00006e  f7fffffe          BL       GUI_SetColor
;;;875    }
000072  e8bd81f0          POP      {r4-r8,pc}
;;;876    
                          ENDP


                          AREA ||i._SetSelection||, CODE, READONLY, ALIGN=1

                  _SetSelection PROC
;;;540    */
;;;541    static void _SetSelection(MENU_Handle hObj, MENU_Obj* pObj, int Index) {
000000  b570              PUSH     {r4-r6,lr}
000002  4606              MOV      r6,r0
000004  460c              MOV      r4,r1
000006  4615              MOV      r5,r2
;;;542      if (Index != pObj->Sel) {
000008  6ee0              LDR      r0,[r4,#0x6c]
00000a  42a8              CMP      r0,r5
00000c  d00a              BEQ      |L44.36|
;;;543        pObj->Sel = Index;
00000e  66e5              STR      r5,[r4,#0x6c]
;;;544        MENU__InvalidateItem(hObj, pObj, pObj->Sel); /* Invalidate previous selection */
000010  4621              MOV      r1,r4
000012  4630              MOV      r0,r6
000014  6ee2              LDR      r2,[r4,#0x6c]
000016  f7fffffe          BL       MENU__InvalidateItem
;;;545        MENU__InvalidateItem(hObj, pObj, Index);     /* Invalidate new selection */
00001a  462a              MOV      r2,r5
00001c  4621              MOV      r1,r4
00001e  4630              MOV      r0,r6
000020  f7fffffe          BL       MENU__InvalidateItem
                  |L44.36|
;;;546      }
;;;547    }
000024  bd70              POP      {r4-r6,pc}
;;;548    
                          ENDP


                          AREA ||.data||, DATA, ALIGN=2

                  MENU__DefaultProps
                          DCD      0x00000000
                          DCD      0x00ffffff
                          DCD      0x007c7c7c
                          DCD      0x00d3d3d3
                          DCD      0x00ffffff
                          DCD      0x00d3d3d3
                          DCD      0x00980000
                          DCD      0x00d3d3d3
                          DCD      0x00980000
                          DCD      0x007c7c7c
000028  04040202          DCB      0x04,0x04,0x02,0x02
                          DCD      GUI_Font13_1
                  MENU__pDefaultEffect
                          DCD      WIDGET_Effect_3D1L
